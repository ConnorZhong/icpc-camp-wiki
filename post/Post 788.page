# UESTC 1848

之前的 post 好像消失了 = =|||

[题目链接](http://acm.uestc.edu.cn/#/problem/show/1848)

题目大意：有一个长度为 $N$ 的序列 $A_1, A_2, \cdots, A_N$，初始 $A_1 = A_2 = \cdots = A_N = 0$。现在要做 $K$ 次操作，其中第 $i$ 次操作是选择一段非空区间 $[L, R]~(1 \leq L \leq R \leq N)$ 赋值为 $i$，即 $A_L, A_{L + 1}, \cdots, A_R$ 修改为 $i$。问经过恰好 $K$ 次操作后序列有多少种可能的形态，输出方案数对质数 $(3 \cdot 13 \cdot 2^{22} + 1)$ 取模的值。

数据范围：$1 \leq K \leq N \leq 10^6, 1 \leq \sum{N} \leq 5 \cdot 10^6$

[skywalkert wrote on 2018-03-09T19:43:59]

---

这个题是这个月Codechef的Long Challenge题目。
因为自己做这个题花了不少时间，感觉这个题比较有意思，所以大概就顺手搬了过来。
因为比赛还没有结束，等结束后我再来post我自己的解法。

[xiper wrote on 2018-03-10T02:00:48]

---

打表找规律找个 1h 应该可以找出来……

令 $T(n, k)$ 表示 $N = n, K = k$ 时的答案，有如下的表：

```
1 0 0 0 0 0 0 0 0 0 0 ...
1 1 1 1 1 1 1 1 1 1 1 ...
1 3 5 7 9 11 13 15 17 19 21 ...
1 6 17 34 57 86 121 162 209 262 ...
1 10 45 130 289 546 925 1450 2145 3034 ...
1 15 100 410 1219 2921 6030 ...
1 21 196 1106 4375 13391 34026 ...
```

……啥也看不出来，模 2 看一下：

```
1 0 0 0 0 0 0 0 0 0 ...
1 1 1 1 1 1 1 1 1 1 ...
1 1 1 1 1 1 1 1 1 1 ...
1 0 1 0 1 0 1 0 1 0 ...
1 0 1 0 1 0 1 0 1 0 ...
1 1 0 0 1 1 0 ? ? ? ...
1 1 0 0 1 1 0 ? ? ? ...
```

……啥也看不出来，差分看一下（此处省略 1h 找规律 TAT……）

最终找到的规律是 $T(n, k) = T(n - 1, k) + T(n, k - 1) + (n - 1) T(n - 1, k - 1)$，边界为 $T(n, 0) = 1, T(0, k) = [k = 0]$。

令 $F(n) = \sum_{k \geq 0}{T(n, k) x^k}$，可以得到 $F(n) = F(n-1) \frac{1 + (n - 1) x}{1 - x}$，边界为 $F(0) = 1$。

于是有 $F(n) = \dfrac{\prod_{i = 0}^{n - 1}{1 + i x}}{(1 - x)^n}$，分治 NTT 算一下分子，再算一下分母就可以得到 $F(n)$ 的 $x^k$ 系数了。分子也可以利用取 $\ln$ 的技巧做到 $O(k \log k)$ 计算。

[skywalkert wrote on 2018-03-13T13:09:30]

---

