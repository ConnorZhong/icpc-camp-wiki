# 2015 长春赛区网络赛 M Robot Dog

这个怎么捉...(伸手

[Nero wrote on 2015-09-13T07:27:25]

---

公式题, 设$d(x,y)$为$x$和$y$的距离, $D(x) = \sum_{y=0}^{n-1}d(x, y)$
那么从$x \rightarrow y$的期望时间是$(n-1)d(x,y) + D(y) - D(x)$


[zimpha wrote on 2015-09-13T07:34:14]

---

@zimpha#163 这个式子好有趣啊，究竟是为什么呢？

[sd_invol wrote on 2015-09-13T09:17:31]

---

假设终点是$t$，设$f(v)$表示从$v$出发的期望时间。为了方便说话，我们设$t$是树的根。结论是$f(v) = f(p(v)) + 2 s(v) - 1$。其中$p(v)$是$v$的父亲，$s(v)$是$v$子树的大小。

具体证明地话，可以从叶子往根归纳。

* 对于叶子来说，$f(v) = f(p(v)) + 1$是必然的。
* 对于一个非叶子，$f(v) = \frac{1}{\deg{v}}(f(p(v))+\sum_{u \in \mathrm{children}(v)} f(u)) + 1$. 根据归纳假设，我们有$f(v) = \frac{1}{\deg{v}}(f(p(v)) + \sum_{u \in \mathrm{children}{v}}(f(v) + 2 s(v) - 1)) + 1$. 整理一下就行了。

之后具体做起来就是维护个up和down，然后LCA求路径和之类之类老生常谈的东西啦。

（你问我怎么发现的结论？我是手dp，算了几项发现的……

[ftiasch wrote on 2015-09-13T09:26:11]

---

找规律统统都是耍流氓！

[Nero wrote on 2015-09-13T11:22:11]

---

@zimpha#163 怎么推的式子

[xiezhahe wrote on 2015-09-14T09:22:44]

---

@chffy#263 救过来啦！

不过欢迎贴blog~

问题发生在不能出现方括号的$i$。。。

需要呼唤运维 @ftiasch  看看能不能修

[xiaojudou wrote on 2015-09-16T10:22:00]

---

嗯，下次再遇到这种问题就去呼唤

[chffy wrote on 2015-09-16T10:52:52]

---


考虑从$u$到$v$($u,v$ 之间有边)的期望时间。

对于$v$是 $u$ 父亲的情况：

$F_i$：  以第$i$个点作为起点，到$i$的父亲需要的期望步数。

$F_i = \sum_{n = 0} ^ {oo} \sum (F[a1] + F[a2] + ... + F[an] + 2 \times n) / k^n / k$

($k$是点$i$的度数)

 ($ak$ 是 $i$的 儿子)

这里代表的是，从$i$号点出发，一共有$n$次走向儿子又走回来，第$n+1$次走向父亲(每次概率是$1/k$，$n$ 可取所有非负整数)。

$= (\sum_{n = 0} ^ {oo}2n \times (k-1)^n / k^n ) / k $ 
 $+ (\sum_{n = 0} ^ {oo} \sum n \times F[j] \times (k-1)^{n-1} / k^n) / k $($j$是$i$的儿子)

这部分是计算每个$F_j$对 $F_i$的贡献。
 
$= (\sum_{n = 0} ^ {oo}2n \times (k-1)^n / k^n ) / k $

 $+ (\sum_{n = 0} ^ {oo} n \times sum \times (k-1)^n / k^n) / k^2 $($sum$是$i$的儿子的$F$之和)

$= ( \frac{2 \times a}{(a+1)^2}  ) / k + (\frac{sum \times a}{(a+1)^2}) / k^2$($a = \frac{k-1}{k}$)

对于$v$是 $u$ 儿子的情况：

$G_i:$ 以$i$的父亲作为起点，到$i$需要的期望步数。

先预处理出$F$值，然后通过换根能得到$G$

对于从$u$到$v$($u,v$可能不相邻)的期望步数：

先任意选一个点当作根，然后处理出$F$ 和 $G$。设$Z$是$u,v$的$LCA$，从$u$到$Z$这条路经都是走通向父亲的边，从$Z$ 到$v$都是走通向儿子的边。所以$u$到$Z$路径上的$F$ 加上$Z$ 到 $v$路径上的$G$就是答案。

PS：这题答案会非常大，所以double精度不够，必须用long double。

[chffy wrote on 2015-09-16T09:42:08]

---

http://chffy.github.io/2015/09/16/hdu5449/
(放在这里都是乱码= =)

[chffy wrote on 2015-09-16T09:49:56]

---

