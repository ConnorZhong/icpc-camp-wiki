# CCPC Hangzhou 2017 G

给出10w个家庭  每个家庭有ai个男孩和bi个女孩
每个男孩和每个女孩都是不一样的
自己家的男孩和女孩不能配对
问有多少种配对方法
保证  sum(ai)==sum(bi)  sum(ai)<=10w

[JamLee wrote on 2017-12-11T05:52:10]

---

如果 $a_i = b_i = 1$，就是标准的错排问题，所以一定要容斥。

为了容斥，必须算至少有 $k$ 对近亲的方案数。对于每个家庭，可以写成一个多项式 $c_0 + c_1 x + c_2 x^2 + \cdots$ 表示这个家庭里面出现 $k$ 对近亲的方案数，分治 FFT 乘起来最后 $x^k$ 的系数就是所求的。

[ftiasch wrote on 2017-12-11T12:49:34]

---

