# Codeforces Round #373 题解

# Efim and Strange Grade

贪心。找小数点后第一个 $\geq 5$ 的数位进位。进位后可能会使前一位 $\geq 5$，如果还有操作余额，那么继续进位。
注意数据 $99.5$ ，整数部分可能产生连续的进位。

# Sasha and Array

线段树经典题。每个节点维护 $(\mathrm{Fib}(a_i), \mathrm{Fib}(a_i + 1))^T$ 的和。区间操作相当于用矩阵 $A$ 乘。

# Andrew and Chemistry

以度 $< 4$ 的节点为根的不同有根树数量就是答案。具体求时可以树 Hash。

正确性：关键的结论，对于树 $T$ 和 $T$ 上的两个点 $a, b$。如果 $T \cup \{a, a'\}$ 和 $T \cup \{b, b'\}$ 同构，那么存在同构映射 $\phi$ 使得 $\phi(a') = b'$.

对树 $T$ 的大小归纳。当 $|T| = 1$ 时显然正确，因为这时有 $a = b$。当 $|T| > 1$ 时，设 $T \cup \{a, a'\}$ 和 $T \cup \{b, b'\}$ 的通过映射 $\phi$ 满足 $\phi(a') = c' \neq b'$。

显然 $c'$ 也是叶子，设和 $c'$ 相邻的点是 $c$，根据同构的定义，明显有 $\phi(a) = c$。如果我们把 $a'$ 和 $c'$ 从树中删掉，那么 $\phi$ 就诱导了一个从 $T$ 到 $T \setminus \{c, c'\} \cup \{b, b'\}$ 的同构映射。

如果把 $T$ 看作 $(T \setminus \{c, c'\}) \cup \{c, c'\}$，因为 $(T \setminus \{c, c'\})$ 是更小的树，根据归纳假设，存在一个同构映射 $\Phi$ 使得 $\Phi(c') = b'$，如果把 $\Phi$ 扩展在树 $T' = T \cup \{b, b'\}$ 上，那么相当于树 $T'$ 的一个自同构，同时有 $\Phi(c') = b'$.
那么肯定能找到另一个自同构 $\Phi'$ 使得 $\Phi'(c) = b, \Phi'(b) = c$（主代码手说：考虑 $b, c$ 的 LCA 就能说明白了）。

把原来的 $\phi$ 复合上这个找到的 $\Phi'$，就能得到想要的把 $a'$ 映射成 $b'$ 的同构了。

# Matvey's Birthday

挺有意思的题。。但是做法却有点。。没意思，也想不出更好的，感觉挺遗憾的。。

首先，显然不会超过 15（团之间的最短路只有 7，在每个团跳一下 8 + 7 = 15）。然后预处理两个东西：

* $\delta_{c, d}$ 表示颜色 $c$ 的某个点到颜色 $d$ 的某个点的最短距离；
* 注意到，颜色 $c$ 的点 $v$ 到某个颜色 $d$ 的点的最短路，要么是 $\delta_{c, d}$ 要么是 $\delta_{c, d} + 1$。所以对于点 $v$ 可以预处理一个 $\mathrm{mask}_v$ 表示它到每种颜色是 $+0$ 还是 $+1$.

那么对于两个点 $i, j$ 来说，如果 $|j - i| \leq 15$，那么存在直接走过去的可能。否则，一定要在某个中间颜色「跳」一步，我们只要枚举是哪种颜色，利用刚才预处理好的 $\delta$ 和 $\mathrm{mask}$ 就可以算出之间的最短路了。

最后注意到一个加速是，对于固定的 $i$，计算最短路需要的信息只有 $j$ 的颜色和 $\mathrm{mask}_j$，这个只有
$8 * 2^8$ 种，可以去掉一些冗余，这样就 AC 了。。

---

我的代码：https://code.icpc-camp.org/ftiasch/acm-icpc/src/master/codeforces/718-codeforces-round-373

[ftiasch wrote on 2016-10-01T04:01:17]

---

