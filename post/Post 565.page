# 2016 ICPC 北京网络赛题解

**免责声明：以下是 ICPCCamp 团队所写的非官方题解，署名代表题解作者，非出题人，谢谢！**
感谢大家的帮助和支持。欢迎大家回帖交流。:)

H题暂未取得 AC，在通过之后会及时补上。

---

## A. The Book List [AC by zimpha]
题意: 有$n$本书, 每本书的格式为CATEGORY 1/CATEGORY 2/..../CATEGORY n/BOOKNAME, 现在要重新格式化这些书的格式. 第$n$个category前面需要有$4(n-1)$个空格, 如果这本书在第$n$个category上, 那么它前面要有$4n$个空格. 同一category里面, category和书名都按照字典序排序, 但是category要排在书前面. 第一个category需要按照字典序排列.
 
题解: 用一个trie存结果, 然后一遍dfs进行输出. 需要注意的是同一个节点内要把category和书名分开存.

## B. Genius ACM [AC by sd0061]
题意: 给出$n$个数$p_1,p_2,...,p_n$, 你要把把这$n$个数划分成若干段(每段都是连续的), 每段的代价这么计算: 
从每段中选出$m$(不够$m$对的话, 选出最多的对数)对数, 计算每对数之间的差值,，然后求平方和，代价是所有选法的平方和的最大值，记为$SPD$。
你要划分成最少的段，使得每段的$SPD$都不大于$k$。

题解：对于固定的一段数，显然排序后从两边一对一对匹配能让代价最大，设$w(l , r)$为$[l,r]$这段区间的代价，显然有$w(l + 1 , r) \le w(l , r), w(l , r - 1) \le w(l , r)$。
所以可以贪心，固定左端点$l$后每次选满足$w(l , r) \le k$的最大的 $r$。问题就是怎么算这个 $r$，可以先计算出满足$w(l , l+2^k - 1) \le k$的最大的 k，然后在$[l+2^k-1 , l+2^{k+1})$这个区间里二分$r$即可。
算一次$w(l,r)$暴力是$O(w \log w)$的，所以不难证明这样做复杂度为$O(n \log^2 n)$。

## C. A Simple Job [AC by zimpha]
题意: 给出一个文本, 问那个词组出现次数最多. 被1个或多个空格分开的相邻单词背称为词组.

题解: 直接模拟就好了. 

## D. Pick Your Players [AC by Nero]
题意：你需要买一个足球队（11个球员），每个球员有位置、价值。花费，有以下限制：
位置分为前锋（1-3人）、中腰（2-5）、后卫（3-5）、守门员（1）
每个人有 $value$，总的 $value$ 是每个人的$value$加起来 ，选一个队长，队长的加两次
每个人有个 $cost$，总花费不能超过给定值
求：最大的 $value$，相应的最小的 $cost$，相应的购买方案数（大于1e9输出1e9）
10组数据，500个候选人，value 和 cost：V and C (0 <= V <= 1000, 0 <= C <= 1000)，花费上界：1000

题解：考虑$dp(i,cost,j,k,r,w)=(value,way)$表示考虑前$i$个球员，费用和为$cost$，选了$j$个前锋$k$个中腰$r$个后卫$w$个守门员这个状态，价值和是$value$,方案数是$way$。然后按照dp字面意思转移就可以了。然后第一维的$i$这里是为了看起来方便，其实是不用开的。
为了方便处理队长，把球员们按照价值从大到小排序，挑的第一个人当队长就可以了。

## E. A Research on "The Hundred Family Surnames" [AC by Nero]

题意： 给一棵树，每个节点上有个颜色，很多询问，询问两种颜色，问从这两种颜色中各取一个节点，距离最大是多少。 

题解：处理出每种颜色的节点们的直径(也就是距离最大的点对)。然后对于两种询问颜色$(a,b)$的直径$(au,av)$和$(bu,bv)$，答案就是$\max\{dis(au,bu),dis(au,bv),dis(av,bu),dis(av,bv)\}$。
$O(n \log n)$算一种颜色的节点们的直径的方法：增量添加节点同时维护直径，假设新加的节点是$z$，原直径是$(x,y)$，那么新直径是$(x,y),(x,z),(y,z)$中的一个。
tips:证明考虑反证法。


## F. Periodic Signal [AC by sd0061]

题意：给a[] , b[] , 求 $\min_{k=1}^n\{\sum_{i=0}^{n-1}{(a_i - b_{(i + k)\ \mathrm{mod}\ n}) ^ 2}\}$

题解：裸 FFT，注意答案最大会有 $10^{16}$ 级别，所以找两个 $10^9$ 左右模数 NTT 后 CRT 即可。

## G. Sewage Treatment [AC by sd0061]

题意：有100家工厂$(x_i, y_i)$排放$s_i$(1~100)单位的废料。有100个清洁厂$(x_j, y_j)$可以处理距离不超过c的至多u单位废料，清洁厂共享u,c，求最佳的u,c，使得废料能被清理完，且$f = u\times \sqrt{c}$最小。(u只能是正整数，坐标是(-1e4~1e4)均匀随机的，一个工厂能被多个清洁厂一起处理) 

题解：将距离离散化，从小到大枚举半径$c$，二分$u$，$u$的二分上界被当前答案与之前算的答案卡住，因为$c$增大$u$不可能也增大。$u$的二分下界拿总流量卡住。check 就建图网络流一下。实测这样很快就能跑过，至于为什么只能说因为数据的随机性。

## H. Ada's Needle Experiment

题意：给定一个边长100的正方形和其中100个点的solid convex hull，随机取一个长度150的线段，求与凸包有交（不仅是交边）的概率。（随机方式为uniformly在正方形内取一个端点，且uniformly取一个方向。精度要求绝对误差<1e-7）

题解: ???

## I. Countries [AC by kybconnor]
题意：A,B两个敌对国分别有1W个导弹，每个导弹有各自的发射时间、飞行时间、造成伤害。两国各有一个防御系统，且分别有各自的持续时间（相当于防御一个时间区间？），开启防御系统时，所有到达该国的导弹按原速度反向。已知B国在X时间点开启防御系统，问A国最少会受多少的伤害。（以上数值伤害1e4，其余1e8）

题解：
对于A打到B的导弹$(t,c,d)$如果$X \leq t+c \leq X+TB$内可以看作B打到A的导弹$(t+2c,c,d)$，如果不在就不用管了
对每个B打到A的导弹$(t,c,d)$，考虑A可以防守这个导弹需要开启防御系统的时间区间
先假设A的防御系统无限长，那么可以算出B能够反弹的次数$$k= \left\{\begin{matrix} \left \lfloor \frac{X+TB-t-c}{2c} \right \rfloor+1 & X\leq t+c\leq X+TB \\ 0 & else \end{matrix}\right.$$
对此，可以计算出A要想防御住这个导弹需要开启防御系统的时间区间$[t,t+2kc]$
则A需要在$[t,t+2kc-TA]$内开启防御系统就可以减少受到的伤害$d$
如果$t \leq t+2kc-TA$那么增加两个事件，$(t,-d),(t+2kc-TA+1,+d)$，然后按时间（第一维）对事件排序，找到（第二维）前缀和最小的时刻，再转化下就ok了



## J. War Chess [AC by zimpha]
题意: 有一个$n \times m$的地图, 从上往下下标号为$1$到$n$, 从左往右标号为$1$到$m$. 每个格子$(i,j)$上有一个value $G(i,j)$. 有两种游戏角色, group 0由玩家控制, group 1由系统控制, 每种都有若干个玩家. 每个角色有4个属性: $HP$-血量, $AT$-攻击力, $MV$-移动值, $[AD_1, AD_2]$-攻击范围. 

玩家只能攻击对方group的玩家, 并且他们之间的曼哈顿距离在攻击范围内. 如果$p$攻击了$q$, 那么$HP_q$会减少$AT_p$. 如果一个玩家的血量小于等于0, 那么这个玩家会从地图中消失.

一开始每个玩家都会占领一个格子, 每个人的格子都互不相同. 每次只能有一个玩家在移动. 如果一个玩家开始移动, 那么之前占领的格子会被释放, 停止移动后, 获得现在站着格子的所有权.

每次移动可以走多步, 每步只能走向相邻的格子(上下左右), 如果从$(i,j)$走到$(x, y)$, 那么$MV$会减少$G(x,y)$. 不能走到有人的格子上, 途中$MV$不能小于0. 如果走到敌人相邻的格子上, 那么$MV$会立即变成0(也就是不能走了). 停下来之后, $MV$会变回成初始值. 每次移动也可以停在原地不动.

游戏开始后, 两个group轮流操作, 先group 0, 然后group 1. 每一个group中, 角色按照顺序依次行动. 每次行动: 角色移动到一个位置(不移动也可以), 然后攻击某个敌人(不攻击也可以). 当一个group的角色都死掉后, 游戏结束.

现在给出你, 一次游戏的log, 要求还原游戏场景(具体输出看output).

题解: 仔细读完题, 然后按照题意模拟即可.


[zimpha wrote on 2016-09-24T09:00:05]

---

沙发

[sd_invol wrote on 2016-09-24T09:00:24]

---

看帖回帖

[ftiasch wrote on 2016-09-24T09:25:19]

---

@ftiasch#4403 老板你今天预习了吗

[nanometer wrote on 2016-09-24T09:35:48]

---

@纳米#4404 in progress

[ftiasch wrote on 2016-09-24T09:36:35]

---

求大神最后一个题讲详细点
大模拟我敲好了，就一个问题不会
move怎么做
一共30组，每组3000个操作，平均下来差不多5个操作能有一个move吧，那就一共18000个move
每次move如果跑最短路，是10000个点40000条边，复杂度爆炸。。。
然而不能BFS因为每个格子的费用不一样
然而如果DFS那就是3^200的复杂度，更是炸
所以真的不明白你们是怎么做move的
求详解QAQ

[XENO_AMESS wrote on 2016-09-24T09:56:58]

---

听说FFT那题有人暴力卡时给A了...

[sd197555 wrote on 2016-09-24T09:57:14]

---

这代码量感觉有一点点大啊，敝队一直在相互甩锅= =

[quailty wrote on 2016-09-24T09:59:25]

---

@XENO_AMESS#4406 首先啊, 一共只有20组数据, 每组3000个操作, 考虑除掉无用的Round of GR和Action of character ID平均下来也就3000~4000个MOVE吧. 我每次MOVE的时候就是跑了一个最短路, 算一算复杂度的话, 其实不是特别大, 1s内应该还是可以接受的. 贴个我的AC[代码](https://gist.github.com/zimpha/8c0f1e579f127d5e082349e3ab115f6f).

[zimpha wrote on 2016-09-24T10:03:21]

---

前排占座。 

[kirito wrote on 2016-09-24T10:11:05]

---

@zimpha#4409 感谢。。。大概数据比我想的“不卡”一些吧QAQ
我还以为会有20组整个棋盘乱走然后最后才攻击一两次结束战斗的那种变态局来着= =

[XENO_AMESS wrote on 2016-09-24T10:30:33]

---

敲碗等H题解

[mektpoy wrote on 2016-09-24T12:33:37]

---

@Sd_Invol#4402 G题怎么写都超时。可以求一份AC代码嘛

[awsd1231 wrote on 2016-09-24T13:30:41]

---

@awsd1231#4416 

[code](https://gist.github.com/Sd-Invol/89a66ed945ac479197896da28fdebb39)

[sd_invol wrote on 2016-09-24T13:33:30]

---

@Sd_Invol#4417 感谢~

[awsd1231 wrote on 2016-09-24T13:50:02]

---

@sd197555#4407 我校一队疯狂提交54次后通过

[xry wrote on 2016-09-24T14:27:08]

---

求一份E题代码...WA到死了

[danagi wrote on 2016-09-24T14:35:47]

---

A题把字符串切开存在vector里面，对vector的数组直接排序比较大小和前缀，也可以过。（听起来蛮复杂，实现起来应该比Trie+dfs容易）毕竟数据规模太小。。不过本渣CE一次，WA若干，到底太菜。。。

[ultmaster wrote on 2016-09-24T17:14:50]

---

@danagi#4423 
[code](https://gist.github.com/neroneroni/01845ed04a7c55dc10274a9058ed6136)

[Nero wrote on 2016-09-24T17:45:56]

---

蒟蒻一枚TAT，想问一个问题，F题为什么在fft的时候要对其中一个数组进行reverse呢？

[bicat wrote on 2016-09-25T03:29:59]

---

比如输入了b数组，然后 for (int i = 0; i < n; i++) xb[i] = B[n - i - 1];

[bicat wrote on 2016-09-25T03:31:10]

---

@bicat#4427 比如输入了b数组，然后 for (int i = 0; i < n; i++) xb[i] = B[n - i - 1];

[bicat wrote on 2016-09-25T03:31:23]

---

@bicat#4429 

因为 $C = A \times B$ 的话，就是 $C[k] = \sum_{i = 0}^k A[i] B[k - i]$. 也就是说卷积的第 $k$ 项是所有下标之和为 $k$ 的项的乘积。

如果 $B'[i] = B[- i]$，那么 $C[k] = \sum_{i = 0}^k A[i] B'[k - i] = \sum_{i = 0}^k A[i] B[i - k]$ 也就是下标之差为 $k$ 的项的乘积，这就是题目所求呀。

[ftiasch wrote on 2016-09-25T05:19:07]

---

NNT CRT卡常 难道不用分块 玄学fft 直接做能过？

[nike0good wrote on 2016-09-25T05:35:12]

---

@nike0good#4431 直接fft 用挂精度的值取最大的一个暴力算一下可过

[mektpoy wrote on 2016-09-25T05:54:38]

---

@Nero#4426 太感谢了！

[danagi wrote on 2016-09-25T07:49:38]

---

@ftiasch#4430 谢谢叉老师

[bicat wrote on 2016-09-25T08:02:13]

---

@nike0good#4431 我直接这样就过啦，玄学 FFT 也是能直接过的。

[sd_invol wrote on 2016-09-25T09:46:27]

---

求问D题优化方法，按题解写的一直TLE

[Samuel wrote on 2016-09-25T11:41:52]

---

@Samuel#4439 
扫了一遍比赛时过的代码，真的没有优化唉...
[code](https://gist.github.com/neroneroni/90fe77bf41b331c86a977090c03bc834)

[Nero wrote on 2016-09-25T15:27:43]

---

想问下B为什么是$O(n\log^2n)$，第一次找最大的$r$好像就已经是这个复杂度了？

[headspin wrote on 2016-09-26T05:42:33]

---

@headspin#4447 稍微想一想为什么先倍增再二分

[sd_invol wrote on 2016-09-26T06:38:45]

---

@Nero#4443 
多谢啦，原来是递推的方向问题。对于这种多维小范围的数据，顺推的转移代价要小好多。

[Samuel wrote on 2016-09-26T08:53:47]

---

H题提供一下出题人的解答：
对于一个固定的方向，可以计算出这个方向下，针头的可行区域。
这个可行区域，是凸包往这个方向的反方向，平移针长的过程中划过的区域，与正方形的交。

对这个交的区域的面积进行积分即是所求的解。

显然这个区域，包含原来的凸包。只需要计算部分的边的积分，再加上原凸包面积即可。

所以可以转化为对每一条边的0°~180°平移针长的区域，与正方形的交的积分。

一条边平移出的平行四边形与正方形的交会有若干种情况，计算出每一种情况的区间，分别积分求和即可。


[fancycoder wrote on 2016-09-26T09:50:31]

---

B题按照题解的方法先倍增再二分
判断用的set或sort都T了。。。
这是为啥呢

[tankche1 wrote on 2016-09-26T12:59:51]

---

@tankche1_20160731#4451  代码在[此](https://gist.github.com/Sd-Invol/13a7ca602d8e836bab0855468dd53729)

[sd_invol wrote on 2016-09-26T16:29:31]

---

@Sd_Invol#4448 Orz

[headspin wrote on 2016-09-27T06:56:20]

---

@Sd_Invol#4453 多谢

[tankche1 wrote on 2016-09-27T11:31:21]

---

