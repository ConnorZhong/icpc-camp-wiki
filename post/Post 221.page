# Shenyang 2015  F Frogs

$N \leq 10\^4$ 个青蛙, 编号 $1, 2, \dots, N$，$M \leq 10\^9$ 个石头, 编号 $0, 1, \dots, (M - 1)$ 每个青蛙可以跳 $a\_i \leq 10\^9$ 步, 下一个位置是 $(\mathrm{当前位置} + a\_i)  \bmod M$， 所有青蛙一开始在石头 $0$， 可以跳随意次数， 问最后所有被跳过的石头的编号之和。

赛上分解所有的 $a_i$， 容斥搞了半天 - - 发现没法求和, 求和的时候由于取模会有重复, 没法去重, 正解应该是怎样的呢。

[TaoSama wrote on 2015-10-25T06:41:41]

---

私以为只能自信容斥……

[ftiasch wrote on 2015-10-25T07:55:23]

---

@Varona#2139 呜呜呜 - - 具体是怎么容斥的呀 0.0 那个求和不会QAQ

[TaoSama wrote on 2015-10-25T08:34:04]

---

@Varona#2139 0.0 突然会了 谢谢叉姐呢 - - 想通了赛上的

[TaoSama wrote on 2015-10-25T08:52:32]

---

$a\_i$ 与 $M$ 求个gcd，得到 $a\_i'$',然后去重，在删掉满足 $a\_i' | a\_j'$ 的 $a\_j$‘，这样剩余的 $a\_i'$ 个数不多，应该可以进行容斥搞一发~不知道这样做是否可行

[12170246 wrote on 2015-10-25T13:52:54]

---

@12170246#2149 嗯 我就是这么做的

[TaoSama wrote on 2015-10-25T16:35:28]

---

@TaoSama#2152 求问容斥复杂度是 $\sqrt{M} \times N$ 吗？这样会不会超时？

[aclsh wrote on 2015-10-26T02:35:02]

---

@aclsh#2157 这个复杂度看上去不会超时吧……

[ftiasch wrote on 2015-10-26T02:37:33]

---

搞出$M$所有约数中, 合法(被跳过的)的数。
这个搞法就是对于令$f[\gcd(a\_i ,M)] = true$, 然后从小到大枚举约数, $f[x \times pr_i] = f[x \times pr_i] \ or\  f[x]$
搞出来之后, 每个合法的数 $d$ 的倍数也是合法的, 但是会计重. 为了不计重, 对于[1, $\frac{M}{d}$] 这一段区间, 需要删去所有和$\frac{M}{d}$不互质的数. 这一部分是
$(\phi(\frac{M}{d})+1) \times \frac{M}{d} \div 2$

[yangyue wrote on 2015-10-26T02:39:05]

---

@Varona#2158 。。。这个居然现场不超时吗QAQ

[yangyue wrote on 2015-10-26T02:40:40]

---

@yangyue#2160 枚举约数的话复杂度貌似是O(M) 枚举ai和m的n个公约数的话复杂度可以是O(sqrt (M)*n)？

[aclsh wrote on 2015-10-26T03:58:41]

---

@aclsh#2161 枚举约数复杂度是$O(\sqrt M)$啊。只需要枚举一遍啊。
这个总复杂度是$O(\sqrt M \times \log M + N\log M), 需要一个map多一个log$

[yangyue wrote on 2015-10-26T04:15:00]

---

@yangyue#2162 求m所有约数的f函数值复杂度怎么做到sqrt(M)*logM？我的做法是对于m的每个约数i 第二层循环找m/i的约数j 用f(i)更新f(i*j) 这样的话复杂度是sigma(sqrt(d)) d是m的约数 这个复杂度目测不出来啊…求解答

[aclsh wrote on 2015-10-26T04:46:05]

---

@aclsh#2163 从小到大枚举所有的约数, 对于$f[x]  == true$, 我们将$f[x \times pr_i] = true$ $pr_i$是m的质因数, $pr_i$的个数最多10个小的很

[yangyue wrote on 2015-10-26T05:14:57]

---

@yangyue#2164in 只要枚举素因子啊 学到了 感谢解答～

[aclsh wrote on 2015-10-26T05:51:09]

---

@yangyue#2164 只要枚举素因子啊 学到了 感谢解答～

[aclsh wrote on 2015-10-26T05:51:52]

---

现场讲这道题的时候，我隐约听见复杂度为 O( n^1.5 ) ......我听错了吗= =

[Voil wrote on 2015-10-26T20:27:55]

---

@Varona#2178 （定睛一看好像还真的是反演的思路。。。。

[QAQ wrote on 2015-10-26T23:13:40]

---

@sorry_QAQ#2177 就是楼上讨论的东西吧

[ftiasch wrote on 2015-10-26T17:35:39]

---

QAQ出题人说有一个类似反演的做法，然而窝并不想得出来，求类似反演的做法
（虽然反演就是容斥，但是除了暴力有什么优化吗

[QAQ wrote on 2015-10-26T16:39:10]

---

@TaoSama#2136 
楼主还有别的题目吗？拿出来一起分享吧！

[wuyanze wrote on 2015-10-27T00:31:29]

---

@Varona#2178 叉姐，n^(3/2) 的做法怎么做= = ：
有n个数b0 , b1 , b2 , …… ，b(n-1) , 求1~m里有多少个数是能  ------  “整除{b}这个集合里任意一个”的？
bi <= 1e9 , m <= 1e9 ， n <= 1e4;
比如说2个数 b0=2 , b1 = 3 , 在1~9里能整除2的有2 ， 4 ， 6 ，8，能整除3的有3 ， 6 ， 9 ；所以答案有6个数


[Voil wrote on 2015-10-27T08:41:56]

---

@Voil#2216 不会。

[ftiasch wrote on 2015-10-27T08:47:08]

---

@Varona#2218 QWQ 那会多大复杂度的？

[Voil wrote on 2015-10-27T08:57:56]

---

@Voil#2222 只会瞎搞…

详见楼上讨论吧。

[ftiasch wrote on 2015-10-27T09:01:30]

---

@yangyue#2159 删除去重的那里没有看懂，为什么是和那个数不互质的数？求解0.0

[keepit wrote on 2015-10-31T10:20:52]

---

粗略看了一下, 发现我的做法似乎和楼上的都不太一样? (也许是我看漏了). 分享一下.
首先, 对每个$a_i$和$m$ 求个gcd, 那么gcd的倍数全部是会被标记到的. 那么我们求一个$f(d)$ -- 表示被$d$标记, 但是不被$d$的倍数标记的位置的和. 那么对M的所有约数求一遍$f(d)$. 求和之后就是答案啦. 
如何求$f(d)$呢? 如果有一个之前求出来的gcd是$d$的约数, 那么所有的$d$的倍数的数字就是被标记的. 再减去那些被$d$倍数标记的数就好了.(其他情况, $f(d)$都是0.) 那么我们的直接暴力平方的枚举约数, 倒着求$f(d)$就好了. 因为$10\^9$以内, 因子数最多的数也就1344个因子. 所以复杂度完全是够的. 如果用$O(M\^{1/3})$估计因子数目的话算法复杂度应该是$O(M\^{2/3})$的.

[yuzhou627 wrote on 2015-10-31T10:24:51]

---

@yuzhou627#2326 LaTeX 似乎又不太好用啦! @Varona#2218 

[yuzhou627 wrote on 2015-10-31T10:27:47]

---

@keepit#2325 就是我们枚举到了d，不能再乘一个和m/d有关的质因数，如果你乘一个p.那么在下次枚举p*d(这个f值肯定标记过)就会出现重复计算。
不知道讲清楚没。。比如m=4.ai=2 那么我们枚举的有2.4   枚举2的时候不能乘2

[yangyue wrote on 2015-11-01T10:26:15]

---

@yangyue#2358 重复计算这部分懂了，现在对于一个d，我们就是要算[1,m/d]中与m/d互质的那些数p与d的乘积的和。但是没有看明白你上面那个公式的含义（即这部分的和如何算呢）。

[keepit wrote on 2015-11-01T12:16:28]

---

@keepit#2359 我觉得您需要先会做hdu 3501

[zjyjer wrote on 2015-11-01T12:44:27]

---

@zjyjer#2360 明白了，非常感谢！

[keepit wrote on 2015-11-01T13:01:38]

---

@yangyue#2358 qwq还是有些小不明白：与M/d互素的数里可能会有M的约数存在，但是这部分在第一步里已经算过了。。这个是如何处理的qwq。比如M=60, d = 20..

[yzq986 wrote on 2015-11-02T13:46:50]

---

@yzq986#2384 我没太懂你的意思啊. 
假设枚举$d = p_1\^{a\_1} p_2\^{a\_2} \dots p\_r\^{a\_r}$ 如果$d \times p\_1$依然是$M$的约数, 那么一定不能乘含有$p\_1$的数, 因为之后会枚举到$d = p\_1\^{a\_1+1} p\_2\^{a\_2} \dots p\_r\^{a\_r}$。
最后如果$d \times p\_1$不是$M$的约数, 此时可以$p\_1$可以随便乘, 因为之后不会重复算了. 
综上就是$[1, \frac{M}{d}]$中与$\frac{M}{d}$互质的数的和

[yangyue wrote on 2015-11-02T16:34:41]

---

@yangyue#2388 终于理解qwq，感谢大神。。还有个小问题qwq，每次算$\phi$的时候有没有更正确的姿势。。我是对$N$个$a_i$先算$\phi$再推上去。。

[yzq986 wrote on 2015-11-03T01:38:23]

---

@yzq986#2391 还是从小到大枚举约数d. 转移枚举p 分情况若p 被d整除那么phi(pd)=phi(d)*p 否则phi(d)*(p-1)

[yangyue wrote on 2015-11-03T02:22:38]

---

@Voil#2216 这个问题退化一下，假设给出的都是质数，再退化一下，假设是前n个质数，那么就转为了求光滑数的数量。而这个应该没有$O(n\^{2/3})$的方法。不过我也只是凭印象，你可以自行搜索wiki一下。

[litaoye wrote on 2015-11-03T04:34:19]

---

@litaoye#2397 惨，谁能把我上面的答案删了，是错的，光滑数不是这样定义的，刚才脑抽了。

[litaoye wrote on 2015-11-03T04:48:40]

---

@12170246#2149 亲测tle？

[world2 wrote on 2015-11-07T14:35:19]

---

