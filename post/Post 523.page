# 2016 Multi-University Training Contest 9 F  Flight

题目链接：http://acm.hust.edu.cn/vjudge/problem/466439
由于hdu挂了，只有hust可以看题可以交

题意：给定一颗10w级的树，边长为1,10w级的询问，对于每个询问给定一个u、v和d，问u到v最少需要多少步(每一步只可以走到与当前点距离大于等于d的点)，如果不可达则为-1，强制在线。



[burglar wrote on 2016-08-17T08:28:53]

---

原题解法似乎有错（至少我们比赛时候的激发是错的……）下面的做法只是渐进复杂度靠谱，不排除因为常数问题 TLE 的可能：

---

做题之前，首先要知道一个 lemma：距离点 $u$ 最远的点一定是直径的端点。

---

首先，答案是 0，1 的情况比较简单。考虑树的一条直径 $(a, b)$，那么距离 $u$ 最远的点可能是 $a$ 或者 $b$（对 $v$ 同理），所以只要满足条件，那么一定可以 3 步解决（先跳到 ab 之一，跳到另一个，再跳到终点），否则一定不可能（因为每次走到长度都是最大的了）。

剩下的问题是如何判断 2 步是否可以。正式地说，就是判断是否存在一个点 $w$，使得 $\min\{\delta(u, w), \delta(v, w)\} \geq d$. 其中 $\delta(x, y)$ 表示 $x, y$ 之间的距离

由对称性，不妨假设 $\delta(u, w) \leq \delta(v, w)$。那么 $w$ 这时候的限制，就是找到 $u, v$ 连线上最中间的一条边 $e$（假装是边吧，点的情况也要做一做），把边 $e$ 删掉后，$w$ 应该在 $u$ 所在的那颗子树。
现在的问题就是要问，删掉 $e$ 后 $u$ 所在的子树内距离 $u$ 的最远点。

那么根据最开始的引理，我们只要知道 $u$ 子树的直径，那么只要 check 两下就行了。那么如果 $e$ 不在直径上，那么子树的直径就是原树的直径。否则的话，我们可以以 $a$ 为根，做一遍树 dp，这样就能一开始预处理出删掉直径上的边 $e$ 两边子树的直径。之后就做完啦。

[ftiasch wrote on 2016-08-17T10:55:55]

---

感觉这个树的直径的lemma十分有用啊，上次也被这个智商压制了一发。

[Kuroda wrote on 2016-10-27T03:09:33]

---

