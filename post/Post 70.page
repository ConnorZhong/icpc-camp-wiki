# 如何求最大值为k的区间的个数

这是一道我和队友YY出来的题目，感觉挺有趣的， 而且希望能看到更好的答案，在此分享一下。

给一个数组，$q$ 次查询，每次查询求整个数组内最大值为 $k$ 的区间的个数。$N \le {10^5}，a_i \le 10^5$，$q \le {10^5}$，$k \le {10^5}$。

我YY了一个每次查询求整个数组内最大值至少为 $k$ 的区间的个数的方法，首先离线从 $k$ 从大到小开始做。总共的区间个数是 $\frac{n(n - 1)}{2}$ 个。把这个数字加入到答案中，接下来我们去找那些最大值小于 $k$ 的区间方案数。对于某个 $k$，那么整个区间就是被 $>k$ 的数字划分为了若干个区间，然后对于这些划分的长度为 $\mathrm{len}$ 的区间，对答案的负贡献是 $\frac{\mathrm{len}(\mathrm{len} - 1)}{2}$。然后随着 $k$ 的减小，某些区间被划分成了更小的区间，这个可以用 set 来处理。set 记录 $\geq k$ 的数字的位置，每次 $k$ 变大的时候通过在原数组排序并记录位置再二分可以找到被划分的哪些点。然后加入到set中，记录答案。然后。这样总复杂度应该是 $O(q \log n)$ ？

这样的话，如果我可以 $O(q \log n)$ 地求出整个数组内最大值至少为 $k$ 的区间的个数，记为 $\mathrm{gao}(k)$。那么对于最初的问题，答案就是 $\mathrm{gao}(k) - \mathrm{gao}(k+1)$。这样复杂度还是 $O(q \log n)$。

我有以下几点希望能探讨一下：

1. 我的引出来的最大值至少为 $k$ 的问题的解法的时间复杂度是否为 $O(q \log n)$ ？
2. 原问题能否有其它的更漂亮更简单的做法？
3. 原问题如果强制在线，是否可做？

[caoyi0905 wrote on 2015-09-24T10:01:23]

---

不知道有没有理解错您的意思
有个yy的想法。。不知道对不对。。
用栈处理出 $$L_i = \max_{(j < i) \wedge (a_j \geq a_i)} j$$
$$R_i = \min_{(j > i) \wedge (a_j > a_j)} j$$
然后对于 $a_i$ 对 $k = a_i$ 的答案的贡献为 $\mathrm{ans}_{a_i} += (i -  L_i) \times (R_i - i) $。

[vainman wrote on 2015-09-24T10:44:42]

---

@vainman#588 啊好像是可以。。而且比我的简单多了。。如果是最大值至少为k的问题有什么好方法呢

[caoyi0905 wrote on 2015-09-24T11:02:09]

---

@vainman#588 啊好像是可以，然后最大值 $\geq k$ 就是对ans弄一个后缀和就可以了。。多谢。。问题解决了。。

[caoyi0905 wrote on 2015-09-24T11:04:23]

---

> @caoyi0905#589 是可以。。而且比我的简单多了。。如果是最大值至少为k的问题有什么好方法呢

2333只会对ans求后缀和
或者上面的 $R_i$ 全部改成 $n$

[vainman wrote on 2015-09-24T11:05:01]

---

似乎在codechef见过这个题, https://www.codechef.com/AUG15/problems/DCGAME
貌似是一样的

[zimpha wrote on 2015-09-24T11:06:06]

---

小 $\LaTeX$ 抄写员参上！

[ftiasch wrote on 2015-09-24T11:23:35]

---

@ftiasch#593 感谢ACM好站长--叉姐， 刚去看完一份简单的Latex教程QAQ

[vainman wrote on 2015-09-24T11:35:55]

---

@ftiasch#593 Orz..突然发现R那里应该是min

[vainman wrote on 2015-09-24T11:37:34]

---

@vainman#596 抄写失误 = = 小抄写员这个月工资没惹。

[ftiasch wrote on 2015-09-24T11:38:58]

---

@zimpha#592 唔是的。。就这么口胡出一道原题= =。。

[caoyi0905 wrote on 2015-09-25T02:22:00]

---

