# ZOJ3828 Jacobi Pattern

题意：给出字符集大小<=M的长度<=N的字符串s。一个字符串满足条件当且仅当它的长度为偶数，且前一半和后一半循环同构。找出s的所有满足条件的子串。N,M<=5000

作者似乎就是希哥，看到希哥曾在在blog中发过题解不过那个blog已经挂了……目前的进展是满足条件的子串是abba这种形式的。枚举中点之后可以比较方便地判断bb这种情况，然而不是很会快速地扩展出满足条件的a。

[KeyID wrote on 2018-05-26T15:41:16]

---

枚举子串的中心，往两侧扩展，将两侧对应位置的字符交替写下来，得到一个字符串$S$。

若前后长度为$L$的子串循环同构，则在$S$中它们对应长度为$2L$的前缀，需要满足它可以由不超过$2$个偶回文串拼接而成。

有一个结论是，若$S=uv$，其中$uv$都是偶回文串，那么要么$u$是$S$的最长偶回文前缀，要么$v$是$S$的最长偶回文后缀。

通过Manacher预处理出每个位置的最长回文半径$f$，即可求出每个前缀的最长偶回文前缀和最长偶回文后缀，剩下部分可以根据$f$数组$O(1)$判断一个子串是否是回文串。

时间复杂度$O(n^2)$。

[Claris wrote on 2018-05-26T17:17:05]

---

> @Claris#5677 

那个结论怎么证明呢。。。


[KeyID wrote on 2018-05-28T11:58:29]

---

@KeyID#5678 
设$S=x_1y_1=x_2y_2=x_3y_3$。
假设结论不成立，那么显然双回文划分数$\geq 3$，设$x_1$为$S$的最长回文前缀，$y_3$是$S$的最长回文后缀，$x_2$和$y_2$都是回文串，则$y_1$和$x_3$都不是回文串。
因为$x_1$是最长回文前缀，所以$|x_1|>|x_2|$，同理$|y_2|<|y_3|$，则$|x_1|>|x_2|>|x_3|$。
................[v.....]
[x1...................][y1....]
[x2..........][y2.............]
[x3.....][y3..................]
设$x_1=x_2v$，那么因为$v$是回文串$y_2$的前缀，所以$v^R$是$y_2$的后缀，也是$y_3$的后缀，因为$y_3$是回文串，所以$v$是$y_3$的前缀，得出$x_3v$是$x_1$的前缀。
因为$x_1$是回文串，$x_2$是$x_1$的前缀，所以$x_2^R$是$x_1$的后缀，又因为$x_2$是回文串，所以$x_2$也是$x_1$的后缀，所以长度$|x_1|-|x_2|=|v|$是$x_1$的一个周期，也是$x_1$的前缀$x_3v$的一个周期。这说明$|v|$也是$v^Rx_3^R$的一个周期，即$x_3^R$是$v^Rv^R...v^Rv^R$的前缀。
因为$v$是回文串$x_1$的后缀，所以$v^R$是$x_1$的前缀，而$|v|$是$x_1$的周期，所以$x_1$是$v^Rv^R...v^Rv^R$的前缀，那么$x_1$的前缀$x_3$也是$v^Rv^R...v^Rv^R$的前缀。
因为$x_3^R$和$x_3$都是$v^Rv^R...v^Rv^R$的前缀，所以$x_3=x_3^R$，即$x_3$是回文串，和假设矛盾。所以结论成立。

[Claris wrote on 2018-05-28T17:33:40]

---

@Claris#5679 懂了。讲的非常详细啊，很感谢！

[KeyID wrote on 2018-05-29T09:07:01]

---

