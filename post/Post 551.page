# Bubble Cup 9 Finals [Online Mirror] F. Heroes of Making Magic III

http://codeforces.com/contest/717/problem/F

题意： 有n堆方块{ai}， 有两种操作， 
1 a b k,  对区间[a, b]的方块全部加k个， 
2 a b，  查询[a, b]能否从一端开始走把该区间的方块全部消灭，消灭的规则是， 作为起点的那一个点的方块立马减1， 每次跳到自己相邻的左边或者右边的位置， 然后跳过去的那个位置的方块个数立马减1， 不允许跳到区间[a, b]以外的地方， 不允许跳到某一个方块个数为0的位置， 最后停留的位置必须是[a, b]的另一端。

查看AC代码后， 发现解法都是维护了线段树的三个值域：
1、 区间内的奇数位值之和 - 偶数位的值之和， 如果答案不等于（区间长度模2）， 任务不可完成； 这一点必要条件比较容易证明。
2、 区间[L, R]内奇数长度的前缀和（假设该前缀为[L, i]， 值为a[i] - a[i + 1] + a[i + 2] - .... +  a[L]）的最小值, 若查询区间的该值小于1， 任务不可完成。
3、 区间[L, R]内偶数长度的前缀和的最小值； 若查询区间的该值小于0， 任务不可完成 

想了很久也没想明白后面两点如何推导或者证明。

[续一秒 wrote on 2016-09-13T10:15:56]

---

大概这样。。

你搞一个 $n$ 个点的图，相邻两个点连上双向边，我们设 $c(x, y)$ 表示 $x \to y$ 这条边被经过的次数。

那么，对于 $v \notin \{1, n\}$，应该有 $c(v - 1, v) + c(v + 1, v) = a_v = c(v, v - 1) + c(v, v + 1)$. 

起点和终点有点细微的问题。。但是总的来说，看着能把所有变量 $c$ 的值解出来，其实就是要求有解，同时都 $\geq 0$. 
大致上还有一个要求是不能有 $c(v, v + 1) = c(v + 1, v) = 0$，但是大概也比较容易解决。。

总之搞出来应该就是那个交错的式子了。。

[ftiasch wrote on 2016-09-13T11:16:34]

---

