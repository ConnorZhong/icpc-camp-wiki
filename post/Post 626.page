# 2015 Asia EC-Final G Legacy of the Void

[题目链接](https://icpcarchive.ecs.baylor.edu/index.php?option=com_onlinejudge&Itemid=8&category=719&page=show_problem&problem=5528)
题目大意：
给出一棵$N$个节点的树，对于树上的节点$i$，如果要尝试破坏它，则有$P_i\%$的概率破坏成功，成功的话可以得到$W_i$点得分。
现在要做$Q$次破坏模拟，每次模拟的影响相互独立，每次模拟会随机地选择一个树上的连通块，尝试破坏连通块里的每个节点，每次模拟可以计算破坏的得分之和作为这次模拟的得分。
这里的随机是指，假设这棵树有$M$种连通块，则每种连通块被选中的概率是$\frac{1}{M}$。
需要求解的是，这$Q$次模拟中第$K$小的得分的期望值。
数据范围：
有$T$组数据$(1 \leq T \leq 30)$，对于每组测试数据有$1 \leq N \leq 200, 1 \leq K \leq Q \leq 50, 0 \leq \sum_{i = 1}^{N}{W_i} \leq 50000, 0 \leq P_i \leq 100$。
输入都是整数，输出要求相对或绝对误差不超过$10^{-6}$，时限10s。
（希望这次没有读错题）

[skywalkert wrote on 2016-11-02T21:32:43]

---

这样行不行 要求第k大先求分布 求分布的话裸做是枚举联通块的lca然后dp. 这个dp可以fft. 然后总size小于k的子树用$2^k$暴力做. 这样复杂度是$200/k*2^k+200/k*fft$, 拿k=20可以?

[yuzuriha_inori wrote on 2016-11-03T12:59:31]

---

其实我感觉这题真正难的地方在于概率的计算？其他部分不需要FFT？
假如我们不考虑最后要除以M。（暂时还不知道做这个，因为我们总不好直接算出来M对吧，精度爆炸。

我们考虑经过一个点u的联通块，统计这些联通块的分布。

一个自然想法是f[x][W]代表在x这个状态下，我们当前的得分和为W的概率是多少。这个Dp过程中我们是需要把方案数也乘进去的。

那么问题在于我们怎么表示这个x，或者说这个x表示什么呢。

首先我们可以发现我们已经知道了u必须选，那么现在考虑一个以u为根的一棵树，其他的点要选当且仅当父亲选了。这个可以考虑在dfs序上DP，f[i][W]代表我们到了dfs序上第i个点。转移有2种：

- 当前这个点不在我的联通块考虑范围以内，那么我们是直接转移到f[r][W]，这个r是在dfs序上第i个点，对应的right，因为它都不取，它的子树也不做考虑，可以直接跳过了。

- 当前这个点在联通块里面，也分两种：成没成功。然后转移到f[i+1]里面去。

这样的话是一次O(N * W)的复杂度。

可以考虑把这个点分治，总的就是O(N \* W \* log N)。

剩下的就是怎么在算概率的时候不爆精度了。。

求高人告知怎么算概率才能不爆精度。。。



[Miceren wrote on 2016-11-03T19:13:59]

---

@Miceren#4743 纠正一下 上面的那个log是没有的 所以就是nw的复杂度。
再加上n比较小 也许直接用double暴力记录方案数就好了？

[Miceren wrote on 2016-11-03T23:21:05]

---

