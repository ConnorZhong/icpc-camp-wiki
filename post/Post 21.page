# 2015 赛氪代码世界杯 E

由$n$个点构成的无向图，一开始没有边。每次在$n^2$条可能的边中随机选择一条边加入图，问期望加入多少次边图会联通。

$n=2,ans=2$
$n=3,ans=3.75$
$n \leq 100$
如果答案是$a \over b$ ，输出 $a \cdot b ^{ -1} \mod P$，$P$为一质数，保证答案存在。

这道题我只会暴力的$O(\mathrm{分拆数}(n))$的做法，希望大家能讨论一下><。

[sd_invol wrote on 2015-09-11T12:56:09]

---

~~根据 [HDOJ 4624 Endless Spin](http://acm.hdu.edu.cn/showproblem.php?pid=4624) 画葫芦可以画出$O(n^4)$的方法……~~

（一时画不出 = =

[ftiasch wrote on 2015-09-11T13:16:51]

---

@ftiasch#122 这道题我也想了蛮久了 能不能问一下是怎么做的呢？

[不会写诗的诗人 wrote on 2015-09-15T14:16:23]

---

@ftiasch#122 对了 我请教的是EndlessSpin...以前就没会

[不会写诗的诗人 wrote on 2015-09-15T15:55:13]

---

@不会写诗的诗人#236 233，那你可以看陈立杰的课件…

[ftiasch wrote on 2015-09-15T17:03:10]

---

@ftiasch#240 会了 谢谢叉老师~

[不会写诗的诗人 wrote on 2015-09-16T01:36:59]

---

这题从那个奇怪的地方回来之后想了好久。。后来学弟帮助下把他给搞过了。。做法蛮复杂的（我比较水，只会用这种方法。。求更间接直接的做法）
联通的期望步数可以通过$\sum{P[L]}$来获得，$P[L]$表示$L$步时图还未联通的概率，然后我是转换成方案数来做的
假定$f_{i, j}$表示$i$个点连了$j$条边时已经联通的方案数，$g_{i, j}$表示$i$个点连$j$条边的方案数，
那么有递推公式：
$$ f_{i, j} = g_{i, j} - \sum_{k = 1..(i - 1), l = 0..j} \binom{i - 1}{k - 1} \binom{j}{l} f_{k, l} g_{i - k, j - l}$$
然后发现其实后面两项就是两次卷积运算，其中一个卷积我是用多项式乘法来解决，另外一个卷积通过生成函数来解决（原谅我的语文能力。。）
然后我重新定义一下F和G的含义 
$F_i(x)=\sum_{j = 0}^\infty \frac{A_j}{j!} x^j$为一个多项式，系数$A_j$表示$i$个点用了$j$条边并且连通的方案数
$G_i(x) = \sum_{j = 0}^\infty \frac{B_j}{j!} x^j$ 为一个多项式，系数$B_j$表示$i$个点用了$j$条边的方案数
那么原来的递推式就变成了
$$F_i = G_i - \sum_{j = 1}^{i - 1} \binom{i - 1}{j - 1} F_j G_{i - j}$$
然后又有一个黑科技，其实很容易知道 $G_i$ 里系数，$B_j=(i^2)^j$
例如$G_1(x) = 1 + x/1 + x^2/(2!) + x^3/(3!) + x^4/(4!) + \dots $其实就是$e^x$
$G_2(x) = 1 + 4x/1 + 16x^2/(2!) + 64x^3/(3!) + \dots $其实就是$e^4x$
。。。。其实$G_i(x) = e^((i^2)x)$，而$F_1(x) = 1$
那么递推式就可以算了，也就是说，任何时刻$F_i$和$G_i$都可以写成e的不同次数幂的线性组合
那么假如求出了$F_i$，那么$F_i$的第$j$项就意味着走$j$步之后联通的方案数，$G_i-F_i$的第$j$项就是走$j$步之后不联通的方案数
也就是说，我们最后的答案就是$G_i - F_i$之后，每一项都除以对应步数时的方案数，就得出概率，然后概率求无穷级数和就是期望了
比如最后 $F_3$ 是等于 e^9x-3*e^5x+2*e^3x，$G_3$ 等于 e^9x，G_3 -F_3=3*e^5x-2*e^3x
然后我们不算出每一项的最后系数，而是分别对每个e计算再求和就行
对于 3*e^5x=3+3*5x+3*5^2x+3*5^3x.....那么就有 \sum_{(i=0..无穷), 3*(5/9)^i}，这个可以直接代入公式3/(1-5/9)=6.75
对于 2*e^3x=2+3*3x+2*3^2x+2*3^3x.....那么就有sigma{(i=0..无穷),2*(3/9)^i}，这个可以直接代入公式2/(1-3/9)=3
那么答案就是6.75-3=3.75步。。
程序和随机结果对拍过，应该没出错。。
最后补一句（我是叉姐的脑残粉~）


[mayf3 wrote on 2015-09-16T05:39:32]

---

@mayf3#251 请叫我公式抄写员！

[ftiasch wrote on 2015-09-16T05:57:31]

---

