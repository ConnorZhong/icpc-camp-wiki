# Opencup XVI Grand Prix of Ukraine H Hero's Quest

有n个点的图, 一开始每个点都不联通. 一开始你被随机传送到某个点, 要进行下面两步操作
1. 使用魔法, 在点$i$的成功率是$p_i$: 随机选个点对修建一条边
2. 如果图不连通, 那么从点集$S_i$中选出一个点, 传送到这个点, 重复上述过程. 如果联通, 那么结束这个过程.

传送需要1单位时间, 其他时间不考虑, 问使图联通的期望时间. 给出了$p_i$和$S_i$. $n \le 20$

这个题有什么好的思路吗?

[zimpha wrote on 2015-09-13T17:45:51]

---

我有个观察。首先图的形态是没有关系的，只关心之前到过哪些点。那么是不是可以 $2^n$ 枚举到过点的集合，然后计算它一直在这些点集里传送，最终连通的概率？

[ftiasch wrote on 2015-09-14T02:08:11]

---

@ftiasch#175 似乎只和联通分量的大小有关, 可不可以枚举分拆数然后高斯消元乱搞. $n=20$的分拆数貌似是$627$

[zimpha wrote on 2015-09-14T02:59:48]

---

@zimpha#180 

~~首先你这么说好像是不对，因为点是有区别的，所以$1 + 2 \neq 2 + 1$。~~

~~然后我觉得主要的意思是，无论在哪个点，对于图的影响是全局的，只有概率不同。所以根本不需要知道连通块的形态。~~

（感觉自己胡言乱语，先删去）

我中午吃饭的时候仔细想想~

[ftiasch wrote on 2015-09-14T03:02:21]

---

感觉会做了。

设$f(v, P)$表示现在在$v$，连通性是$P$所需要的期望步数。$P$的转移是拓扑的，只有$v$之间存在自环，高斯消元即可。

[ftiasch wrote on 2015-09-15T17:01:02]

---

@ftiasch#238 是固定$P$对$v$做高斯消元, 还是固定$v$对$P$做高斯消元?

[zimpha wrote on 2015-09-16T06:53:07]

---

@zimpha#254 固定$P$，做$v$的消元，只有$20$个。

[ftiasch wrote on 2015-09-16T08:08:27]

---

思考了下, 貌似懂了

[zimpha wrote on 2015-09-16T08:09:43]

---

@zimpha#173 弱弱的问一下，这个opencup的帐号怎么注册？

[u0qyz1234 wrote on 2015-09-17T07:31:20]

---

今天训练完才发现这题居然就是[这道](http://acm.hdu.edu.cn/showproblem.php?pid=4936) = =

而且那个I题也在[这里](http://acm.hdu.edu.cn/showproblem.php?pid=4943)出现过。

[sd_invol wrote on 2015-10-03T12:10:26]

---

@Sd_Invol#1364 是的，出题人就直接从上面蒯了两道多校

[AngryBacon wrote on 2015-10-03T12:36:25]

---

考古，经过发展，我们现在知道这题可以使用 stirling 容斥了！

https://blog.csdn.net/werkeytom_ftd/article/details/78947101. 

[ftiasch wrote on 2018-04-07T19:43:16]

---

