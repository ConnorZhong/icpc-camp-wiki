# 2015 上海赛区网络赛 D Count the Grid

没有人问这一发吗
给你一个 $h \times w$ 的点阵，每个点有一个价值（范围 $[1, m]$）。现在在给你 $n$ 个矩形区域和矩形区域内的最大值，问你这样的点阵有多少。

$h, w \leq 10^5, n \leq 10, m \leq 10^4$ ，答案对 $10^9+7$ 取模

[raindemon wrote on 2015-09-27T03:06:48]

---

@raindemon#733 大概就是先把每一块独立的区域搞出面积和能填的最大值（覆盖的最小值）然后填完有可能满足若干矩阵的条件 用状压即可。

[fancycoder wrote on 2015-09-27T03:10:27]

---

首先，离散化，变成 $2n \times 2n$ 的网格。

接着，对于每个离散的格子，求出它的元素可以取的最大值（即覆盖它的矩形中的最小值），记为 $M_{i, j}$，以及恰好等于这个值的矩形的集合 $R_{i, j}$。

最后，dp。设 $f(i, j, S)$ 表示正在考虑了格子 $(i, j)$，对于 $(i, j)$ 有两种可能：

1. 没有取到最大值，方案数是 $(M_{i, j} - 1)^k$，其中 $k$ 是离散格子 $(i, j)$ 中的元素个数。

2. 取到最大值，方案数是 $M_{i, j}^k - (M_{i, j} - 1)^k$，$S$ 变成 $S \cup R_{i, j}$。

答案就是 $f(2n, 2n, [n])$。复杂度是 $O(n^2 2^n)$。

[ftiasch wrote on 2015-09-27T03:40:30]

---

@ftiasch#736 因为状态相同的格子影响是一样的，可以把这些格子合并起来，复杂度会变成$O(min(n^{2}, 2^{n})\cdot2^{n})$。赛后补的时候跑起来还是蛮快的～

[zyeric wrote on 2015-09-29T13:12:05]

---

@zyeric#993 我大概也是这样 处理每个独立状态的区域，这个是用的容斥原理复杂度也是2^n*2^n，然后扫一遍这些区域dp，但一直WA 有啥坑点吗

[cq_phqg wrote on 2015-09-30T05:01:19]

---

@cq_phqg#1028 看看离散化那里有没有写错吧，还有面积计算的地方（别问我为什么会这么说

[zyeric wrote on 2015-09-30T12:18:47]

---

@zyeric#1045 换了种写法就通过了，谢谢！

[cq_phqg wrote on 2015-10-01T10:56:53]

---

