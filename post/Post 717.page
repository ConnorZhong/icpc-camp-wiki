# Petr Mitrichev Contest 12 B Random Domino Placements

你需要在 $30 \times 30$ 的网格中放入一些 $1 \times 2$ 或 $2 \times 1$ 的骨牌，使得任意两个骨牌不重叠，可以不放满。

其中竖着放置一枚骨牌则在靠上的格子填入 T，靠下的格子填入 B；横着放置一枚骨牌则在靠左的格子填入 L，靠右的格子填入 R；没有被覆盖的格子填入 . 。

两种合法的放置被视为不同，当且仅当存在一个格子在两种方案里对应不同的字符。

设这样放置的方案数是 $m$，假设这 $m$ 种方案出现的概率相等，你可以算出每个 $a \times a$ $(a = 1, 2, 3)$ 的子矩阵里每种可能的局面期望会出现多少次，共有 $9918$ 种局面。

请你给出 $30000$ 种方案，使得每种可能的 $a \times a$ $(a = 1, 2, 3)$的子矩阵局面在你的所有方案中出现的期望次数与上面的期望值近似相等，其中对于每种可能的局面，要求标准差不超过 $6$。

[skywalkert wrote on 2017-08-19T20:23:47]

---

怎么一种 mcmc 的感觉。。。

[ftiasch wrote on 2017-08-20T02:33:32]

---

偷窥了一下 Petr 的做法，看上去是每次随机调整 1000 次然后输出。

---

每次调整有 1/3 的概率观察一个 $1 \times 2$ 的位置，或一个 $2 \times 1$ 的位置，或什么也不做。

如果观察的位置恰好有一个完整的骨牌，则移除这个骨牌。

否则如果观察的位置有至多一个不完整的骨牌，把可能重叠的骨牌移除，然后添上一个完整的骨牌。

---

能否请论坛里的大佬讲解/分析一下这样做的道理？

[skywalkert wrote on 2017-08-20T14:48:01]

---

@skywalkert#5275 我感觉就很像是 MCMC。。。但是我也很有可能在胡说。。。


[ftiasch wrote on 2017-08-20T15:19:08]

---


我大概过了一遍，我觉得你可以想想为什么其他做法不对。

这个题的 checker 应该不难写，你可以试试如果 xjb 随机，什么 pattern 出现的次数比较多，再反过来想标程这样做为什么是对的。

[sd_invol wrote on 2017-08-20T18:14:19]

---

@ftiasch#5276 叉姐说的是正解呀， Petr 在讲题视频里表示是 MCMC。

1/3 不太确定其含义，但之后的操作保证了每次变换是可逆的，大概就是从局面 u 到局面 v 的概率和从 v 到 u 的概率相同，然后分布就比较均匀啦。（也许我的理解不全/有误）

MCMC 需要预先随机一定次数来提升 sample 关于目标分布的 quality，惊奇地是这个题不预先多随几次也可以过。

[skywalkert wrote on 2017-09-12T17:09:58]

---

1/3 概率走到当前状态和不处理两个骨牌覆盖当前观察位置不影响随机游走后的概率分布，所以随便设设就好。

主要是得保证能从任一状态出发到达所有状态，且对于每种转移总存在一个与之反向的转移出现概率与之相等。

采样点之间的随机游走次数就玄学了……反正时限巨大？

[skywalkert wrote on 2017-09-12T19:17:14]

---

