# BZOJ 5058 期望逆序对

长度 $n$ 的数组，随机交换 $K$ 次，求逆序对数的期望。结果乘 $\binom{n}{2}^K$ 后除以 $(10^9+7)$.

$n \leq 10^5, K \leq 10^9$

[shdut wrote on 2016-07-22T11:55:25]

---

首先根据期望的线性性只要对每一对(a[i],a[j])计算贡献并加起来就行了。
对于一对下标i,j，令p=a[i],q=a[j]，考虑交换K次之后p和q的各种位置情况，共有7种（因为剩下n-2个下标是等价的，可以把状态压缩），矩乘求出各情况的概率，然后就能算各个情况下逆序对的期望，计算时会涉及到i-1,j-i-1,n-j。 用树状数组就可以nlogn维护了。

[jcvb wrote on 2016-07-22T12:25:39]

---

状态和下标没有关系吗？

[shdut wrote on 2016-07-22T13:03:00]

---

@shdut#3948 请问有题目链接嘛？


[Fancy wrote on 2017-08-28T02:02:23]

---

@Fancy#5310 http://codeforces.com/problemset/problem/513/G3 

[ftiasch wrote on 2017-08-28T02:46:52]

---

