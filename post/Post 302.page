# Hefei 2015 J Kingdom of Tree

题意：给出一棵n个节点的树，边上有权$L[x][y]$，定义一条边$xy$$\in S$当且仅当$R[x]+R[y]>=L[x][y]$,现在要给每个节点x确定$R[x]>=0$,使得 $ \frac{ \sum R[x]} {\sum L[x][y]\cdot [xy \in S]}$最小。$n<=30,0<=L[x][y]<=1e9$
感觉是01分数规划模型,不过不会做啊

[_ilovelife wrote on 2015-11-24T08:54:31]

---

首先。。你得知道那个线性规划就是 KM 的顶标。。树又是二分图。。所以最小化顶标就是最大匹配。。

然后。。既然是分数规划。。先二分来一发咯。。

最后。。树有个重心，重心去掉之后。。最多只有 15 个点。。暴力 2\^15 一下。。想个办法并一并，就做完了。

[ftiasch wrote on 2015-11-24T13:12:13]

---

还是有些迷惑，如何才能实现并一并呢，把重心并上去的时候最大匹配不是会发生变化嘛？

[_ilovelife wrote on 2015-11-24T16:21:02]

---

@_ilovelife#2851 这个。。泥想，把重心去掉之后的每个联通块只有一个点跟重心有边(不然有环了对吧)，那就分别记录下那个连了边的点取和不取两种情况的最大匹配呗。。合并的时候枚一枚重心的匹配情况就行了

[flydutchman wrote on 2015-11-25T18:30:33]

---

二分答案完最暴力的方法不是枚举哪些边在集合中嘛，枚举完再用KM求出最小的$\sum{R}$。

但是直接枚举$2\^{30}$肯定是要跪的，然而我们发现集合中多一条边也不过是KM的二分图多一条边而已。所以我们可以考虑重心，把重心挖掉的话那么剩下每个联通块大小不超过15，就可以直接暴力$2\^{15}$枚举出每个联通块的最优值，联通块之间不受影响。要不然就是重心和它的某个邻居匹配了，这时候也可以用和上面一样的方法处理。

[sd_invol wrote on 2015-11-25T19:21:58]

---

哦哦，已经明白了，谢谢大家

[_ilovelife wrote on 2015-11-25T23:59:44]

---

bb完写着写着发现自己也不会做了 = = 要如何去并一下

[sd_invol wrote on 2015-11-26T07:20:13]

---

我是这样子做的：
考虑树dp求最大匹配的时候
$dp[x][0]=\sum dp[y][1],y\in x的儿子$
$dp[x][1]=\sum dp[y][1]+max \lbrace dp[z][0]-dp[z][1],z\in x的儿子\rbrace$
分别代表根x不匹配或者和某个儿子节点匹配
只要枚举了选择哪些边，dp[x][0]和dp[x][1]都是确定了的
于是可以枚举重心连接的边的是哪一条，再枚举那棵子树的选边情况，那么只要保证其他子树的选边情况不会使得最大匹配变大再算一个最小值就可以了。
做的时候将所有状态拿出来，按照${dp[z][0]-dp[z][1]}$排序之后扫描一遍取最小值就可以了
另外由于边权很大，这题的精度会有些奇怪

[_ilovelife wrote on 2015-11-26T08:11:44]

---

> @_ilovelife#2881 保证其他子树的选边情况不会使得最大匹配变大

问题就是要如何保证其他子树的选边情况不会使得最大匹配变大呢？

[sd_invol wrote on 2015-11-26T11:53:19]

---

@Sd_Invol#2882 对于一种确定的边选或不选的方案$\sum dp[y][1]固定$，最大匹配只受$max\lbrace dp[z][0]-dp[z][1]\rbrace$影响，所以只要保证我们枚举的这个子树的$\lbrace dp[z][0]-dp[z][1]\rbrace$是所有子树中最大，排序即可

[_ilovelife wrote on 2015-11-26T12:23:55]

---

@Sd_Invol#2882 

对于每颗子树 $i$ 每种选边方法 $S$ 三有两个值，底值 $A\_{i, S} = \mathrm{dp}\[i][1] - \mathrm{cost}(S)$ 和增值 $B\_{i, S} = \mathrm{dp}\[i][0] - \mathrm{dp}\[i][1]$。

现在就是想问，是否存在一个选取方法 $S\_1, S\_2, \dots, S\_k$，使得 $\sum\_{i} A_{i, S\_i} + \max\_i B\_{i, S\_i} \leq 0$ 

我们不妨枚举 $\max\_i B\_{i, S\_i} = M$，那么这样就是说，其他人选的增值只能 $\leq M$啦，请问它们能选的 $A$ 的和最小是多少呢？聪明的小读者一定会做了

[ftiasch wrote on 2015-11-26T12:36:42]

---

@Varona#2884 理解了……总算把这个题使劲过掉辣 = =

[sd_invol wrote on 2015-11-26T15:02:28]

---

