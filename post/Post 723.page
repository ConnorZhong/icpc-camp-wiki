# 一道点分治的题目

给出n(1 <= n <= 50000)个点，每个点有个权值a[i]，给一个k(2 <= k <= 500)，求有几个不同的联通子集权值和模k等于i(0 <= i < k)，求出对于所有的i的答案。
只知道答案的复杂度是nlognlogk，不知道答案具体是什么。

[824850041 wrote on 2017-09-08T08:37:16]

---

对着[这个题](http://acm.hdu.edu.cn/showproblem.php?pid=5909)画画葫芦可以得到$O(nk\log{n})$的点分治 + 树形依赖背包做法，以及$O(nk\log{k})$的 FFT 优化转移的树 dp 做法 ...... 然而恕我愚钝，不太能把这个 $k$ 弄成 $\log{k}$ ......

[quailty wrote on 2017-09-08T09:08:45]

---

@quailty#5329 谢谢q神，我再研究研究。

[824850041 wrote on 2017-09-08T09:46:06]

---

设 $f(u, r)$ 表示以 $u$ 为根，余数是 $r$ 的连通块数量。
如楼上 qls 所说，$f(u, *)$ 大致就是 $u$ 的儿子们做个 FFT 卷积。
这里可以做得更细致一点。。。如果 $u$ 子树大小超过 $k$ 个，称为大树，否则称为小树。
在算 $f(u, *)$ 的时候，先把儿子里面的大树用 FFT 合并，这种合并只会有 $O(n/k)$ 次，总的是 $O(n \log k)$. 之后把得到的 dp 数组用 qls 所说的树形依赖背包做一下，这里每个点只会被算一次，所以复杂度是 $O(nk)$.

剩下的问题是小树里面了。。但是我们知道可以限制 $r < size(u)$，暴力复杂度就是 $s^2$ ($s \leq k$). 这里复杂度也是 $O(nk)$.

[ftiasch wrote on 2017-09-08T12:57:09]

---

@ftiasch#5331 这题带点权，处理小树部分用到的 $r<size(u)$ 似乎不太真啊

[quailty wrote on 2017-09-08T16:04:05]

---

@quailty#5332 您说得对。。。那我觉得 $o(nk)$ 是不存在的。

[ftiasch wrote on 2017-09-08T16:09:28]

---

