# Petrozavodsk Summer 2015 Warsaw U Tasks A Sorcerers of the Round Table

标题这么长好带感。

用 $[n]$ 的排列填一个长度为 $n$ 的环，要求相邻两个数大小不超过 $p (p \leq 3)$，且有 $k$ 个条件，一个条件要求某个数不能在另外一个数的正右方，单向的关系。现在 $n$ 已经填在了某个位置，求剩下数字可行的方案数 $(n \leq 10^6, k \leq 10^5)$

$p$ 小于 $3$ 的情况都是简单的，就是 $p=3$ 的情况处理起来总觉得很麻烦

[sd_invol wrote on 2016-03-27T12:21:20]

---

如果我没看错题，就是有 $n$ 个点的图，$i \leq j$ 有边当且仅当 $|i - j| \leq 3$，然后数汉密尔顿路的数量？

感觉除了连通性状压 dp 没啥别的做法啊……但是复杂度似乎又有点大。

[ftiasch wrote on 2016-03-27T16:56:50]

---

@Hayashimo#3417 

妈呀被装修了一下

看明白标程在干嘛了……通过枚举两端接的啥强行dp出从$n$出发到$n-1$结束或者反过来的链的数量，相当于它把转移都人肉了，所以复杂度才不至于非常大。

[sd_invol wrote on 2016-03-27T18:05:47]

---

这个题好像就是POI2015(XXII OI) Czarnoksiężnicy okrągłego stołu。
当时我$p\leq 2$时乱搞，$p=3$时不考虑$1$的座位进行DP。
相当于知道了前$i$个人的位置序列，然后现在往里插入第$i+1$个人。
可以发现对于$i+1$的位置安排，我们只关心$i-2,i-1,i$的相对顺序以及它们的相邻、边界情况。
所以设$f[i][j][S_1][S_2]$表示已经安排了前$i$个人的座位，$i-2,i-1,i$的相对顺序为$j$，是否有人在两端点为$S_1$，是否有人相邻为$S_2$的方案数。
答案最后再除以$n$。
人肉模拟下转移，然后就轻易地A掉了。
代码：http://paste.ubuntu.com/15567486/

[Claris wrote on 2016-03-31T12:37:57]

---

