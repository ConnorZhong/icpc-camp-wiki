# 关于位运算与线段树

给定正整数序列，有两种操作：
1、[l,r]区间XOR X 
2、询问[l,r]的xor 和，and 和，or 和。
N<=10^5 ai<=2^20

[Herrwerner wrote on 2016-10-28T12:36:54]

---

N<=10^5 ai<=2^20

[Herrwerner wrote on 2016-10-28T12:37:14]

---

每一位是独立的，所以只考虑 a_i 属于 {0 , 1} 的子问题，显然线段树可以轻松解决。

[sd_invol wrote on 2016-10-28T14:08:43]

---

@sd_invol#4687 是说把这20位分开处理么？在线段树上开20位的数组做吗？


[Herrwerner wrote on 2016-10-28T23:57:35]

---

@Herrwerner#4688 

开 20 个线段树的办法当然可行，但是会多一个 20 的常数。

我想一个更好的办法是：

1. 对于 xor，可以直接打标记。

2. 对于 and/or，实际上就是要知道每一位上有没有 0/1. 可以开一个 $2^{40}$ 长度的 long long，用低的 $20$ 位表示有没有 $0$，高的 $20$ 位表示有没有 $1$. 每次 xor 的话，就是对应改一下。

[ftiasch wrote on 2016-10-29T00:26:11]

---

@ftiasch#4689 
一个区间的值为区间里所有数and之和。
给定n个数，求这n个数所有子区间（n*（n+1）/2个）的值之和。
n最大为1e6
请问这个怎么求？

[Fancy wrote on 2016-10-29T00:53:09]

---

@Herrwerner#4685 请问有题目链接吗？

[Fancy wrote on 2016-10-29T01:26:09]

---

@Fancy#4690 是不是可以按位考虑，对于每一位，只有一段区间全是1才会有贡献，只要遍历一遍统计所有连续为1区间的长度，答案加上 $(L*(L+1))/2*(2^k)$

[3ZStarve wrote on 2016-10-29T01:27:45]

---

@3ZStarve#4692 原来是这样写的，谢谢😁

[Fancy wrote on 2016-10-29T01:41:37]

---

@Fancy#4691 哈，其实只是我自己想出的题...想看看自己的解法对不对

[Herrwerner wrote on 2016-10-29T03:55:14]

---

@ftiasch#4689 原来这样也可以写。比我之前方法还好。
我原本是想引入一个新变量:UNXOR ：1表示每一位上只有一部分是1，0表示全部为 1或全部为0.
我发现UNXOR在区间XOR时，不会变。然后只有在子区间修改时才会变。
而且这个UNXOR可以用来更新 and 和 or。
哈，谢谢啦

[Herrwerner wrote on 2016-10-29T04:03:27]

---

