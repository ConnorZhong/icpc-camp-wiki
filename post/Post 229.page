# Shenyang 2015 K Kykneion asma

题目是：给定 $a\_0, a\_1, a\_2, a\_3, a\_4 \leq 10\^6$ 和 $n \leq 20000$，问有多少 $n$ 位五进制数字，满足里面 $0$ 出现不超过 $a\_0$ 次，$1$ 出现不超过 $a\_1$ 次 ... $4$ 出现不超过 $a\_4$ 次。
听说有两种解法，求解姿势~

[12170246 wrote on 2015-10-27T08:23:59]

---

我看着不就是 FFT 搞 5 下嘛…

[ftiasch wrote on 2015-10-27T08:51:49]

---

设$W(n,a\_0,a\_1,a\_2,a\_3,a\_4)$代表可以有前导$0$的$n$位$5$进制数字，至多$a\_i$个数字$i$的方案数。

$W(n,a\_0,a\_1,a\_2,a\_3,a\_4) - W(n-1,a\_0-1,a\_1,a\_2,a\_3,a\_4)$就是最后的答案，相当于减去一定有前导$0$的方案数。

接下来的问题就是求$W(n,a\_0, a\_1,a\_2,a\_3,a\_4)$：

考虑容斥，设$f\[i\]\[j\]\[mask\]$为考虑了填了$i$位数字，有$mask$的数字使用次数超过了限制，且考虑完全部$n$位数字后有$j$种数字超过限制。

考虑转移：

对于一定要超过限制的数字$k$，第一次填的时候直接填$a\[k\]+1$个，然后就当作普通的数字来看了。

$f\[i\]\[j\]\[mask\] = f\[i - 1\]\[j\]\[mask\] \cdot (5 - j + |mask|) + \sum_{mask \wedge (1 << k) > 0} f\[i - (a\[k\] + 1)\]\[mask - (1 << k)\] \cdot \binom{i-1}{a[k]}$。

最后用 $f\[n\]\[j\]\[mask\] (|mask|= j)$更新答案。

[代码](http://paste.ubuntu.com/12977852/)，复杂度$O(n \cdot 5\^2 \cdot 2\^5)$

实际上，稍微改改状态就能优化成$O(n \cdot 5 \cdot 2\^5)$。

[代码](http://paste.ubuntu.com/12977943/)

[chffy wrote on 2015-10-27T11:55:27]

---

@Varona 叉姐，公式显示又出了问题= =

[chffy wrote on 2015-10-27T12:00:36]

---

@chffy#2226 =w= 修好啦！

[ftiasch wrote on 2015-10-27T12:40:13]

---

@Varona#2219 硬要搞fft我也不反对，只不过mod 1000000007会让这题莫名枯燥。所以我还是支持不足20行的dp。

[AHdoc wrote on 2015-11-01T13:15:25]

---

@chffy#2225 qwq弱问优化后的dp状态是如何定义的。。

[yzq986 wrote on 2015-11-02T15:44:59]

---

@yzq986#2386 
$f[ i ][mask]$代表填了$i$位，数字集合$mask$是随便填且其它数字填的数量要超过限制的方案数。

然后初值就是看$mask$里面有缺少的数字数量的奇偶性来确定$f[0][mask]$是$-1$还是$+1$。

这个状态相当于把之前的$j$压到了$mask$里。

[chffy wrote on 2015-11-02T16:28:57]

---

