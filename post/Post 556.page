# UVALive 2666 Servers

题目链接 http://vjudge.net/problem/32235
题目大意：
有 $n \leq 30000$ 个点，$m \leq 5n$ 条带权无向边，每个点有一个 rank 值，统计所有点对 $(v, w)$ 的数量。满足对任意 $u$，若 $v$ 到 $u$ 的最短路不超过 $v$ 到 $w$ 的最短路，则 $\mathrm{rank}(u) \leq \mathrm{rank}(w)$. 

[ZJZNKU wrote on 2016-09-16T16:47:15]

---

原题里面有一个重要的条件 $1 \leq \mathrm{rank}(v) \leq 10$.

固定点 $w$，如果 $(v, w)$ 满足条件，则对于任意满足 $\mathrm{rank}(w') > \mathrm{rank}(w)$ 的 $w'$，都有 $\delta(v, w) < \delta(v, w')$.



[ftiasch wrote on 2016-09-16T20:24:28]

---

你，至少漏了 3 个条件：

1. $1 \leq \mathrm{rank}(v) \leq 10$
2. 每个点的度不超过 $10$;
3. 答案不超过 $30n$. 

我说一个复杂度正确的算法：

用每个 $w$ 作为源点求单源最短路，特殊的是要 $n$ 个最短路一起求，源点 $w$ 到 $v$ 的最短路记为 $d_w(v)$. 
对于点 $v$，维护已经确定的 $d_w(v)$ 中的 $\mathrm{rank}(w)$ 的最大值，记做 $M(v)$.
当 $d_w(v)$ 出堆时，若 $\mathrm{rank}(w) < M(v)$，则不进行更新。否则，将答案 ++.

以上算法的时间复杂度是 $O(10 \times 30n \times \log n)$. 至于正确性，稍微考虑一下也比较自然吧……

[ftiasch wrote on 2016-09-17T03:45:18]

---

@ftiasch#4291 orz。。有点懂了，谢谢！！！

[ZJZNKU wrote on 2016-09-18T15:00:47]

---

@ftiasch#4291 您好！我今天开始做这题的时候突然又发现了一个不懂的地方，就是为了记录$ d_{w}(v) $，需要$ n^2 $的内存空间。我原先以为可以用map来存这些值，然后可以通过某种判断使得并不是所有值都需要求出，但今天一想发现我这想法不对。请问这个问题该怎么解决？

[ZJZNKU wrote on 2016-09-21T16:00:54]

---

@ZJZNKU#4372 我觉得就是用 map 判断一下啊。。

[ftiasch wrote on 2016-09-22T01:10:55]

---

@ftiasch#4373 您好！请问这个地方可以解释的详细一点吗？我不太明白为什么不用把$n^2$个最短路都算出来。谢谢！

[ZJZNKU wrote on 2016-09-22T09:54:25]

---

@ZJZNKU#4377 因为你每确定一个，就相当于答案 +1，题目都告诉你答案不超过 $30n$，所以你更新的不会超过这么多啊。

[ftiasch wrote on 2016-09-22T11:37:38]

---

@ftiasch#4378 但是如果答案小于30n，不就要把n^2 个最短路都算出来了吗？

[ZJZNKU wrote on 2016-09-22T15:00:13]

---

@ZJZNKU#4379 只要算 $30n$ 个最短路吧…………

[ftiasch wrote on 2016-09-22T15:48:58]

---

@ftiasch#4380 orz抱歉我比较蠢还是没想明白。。比如说我用dijkstra+堆来算这些最短路，那么第30n次pop的时候算法就可以结束了吗？我一直觉得大概存在v和w相距很远，但也是一个符合题意的点对的情况。

[ZJZNKU wrote on 2016-09-23T02:24:25]

---

@ZJZNKU#4385 是存在。你还是再看看 https://async.icpc-camp.org/d/556-uvalive-2666-servers/5 这个回复吧……

[ftiasch wrote on 2016-09-23T02:47:12]

---

@ftiasch#4386 orz重新看了一遍之后我又多了2个问题。第一个问题是rank(v)<=10有用吗？第二个问题是为什么要n个最短路一起求？我想我大概是哪里理解错了。。顺便请问“若rank(w)<M(v)，则不进行更新”这里不进行更新的意思是不用$d_{w}(v)$更新最短路还是不用它来更新ans？

[ZJZNKU wrote on 2016-09-23T08:21:58]

---

@ZJZNKU#4389 

1. 我觉得好像没啥用。
2. 不一起求的话，怎么维护 rank 嘛。不更新的意思就是把这个东西从堆里扔掉。。因为它已经在这个点跑输了别人，再跑下去也不可能超过别人了。

[ftiasch wrote on 2016-09-23T09:16:34]

---

@ftiasch#4395 有点明白了！如果rank(w)<M(v)，那么用$d_{w}(v)$更新出来的新的最短路$d_{w}(v1)$必有rank(w)<M(v)<=M(v1)，所以可以把$d_{w}(v)$舍弃掉。是这样吗？

[ZJZNKU wrote on 2016-09-23T09:43:19]

---

@ZJZNKU#4396 对。

[ftiasch wrote on 2016-09-23T11:40:30]

---

@ftiasch#4399 orz谢谢！！

[ZJZNKU wrote on 2016-09-23T11:43:29]

---

