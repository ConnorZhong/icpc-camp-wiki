C. Timofey and remoduling
=========================

**题意: ** 有一个模$m$($m\le 1e9+7$, $m$是质数)的等差数列,
长度为$n$($1\le n\le 100000$). 现在打乱顺序给你, 要你输出首项和公差,
或者判断输入不合法. 保证输入的数字两两不同.

**做法: ** 假设$n<\frac{m}{2}$. 随便选择两个数作差.
如果这个差是公差的$k$倍, 在一个不模$m$的等差数列里,
这个差值会作为两个数字的差出现$n-k$次. 然而这里$m$是质数,
还大于$n$的两倍, 所以不会有干扰, 也是出现$n-k$次.
这样我们就除一下得到了公差. 随便选一个数不断减公差就得到了首项.
check一下做完了. 如果$n\ge\frac{m}{2}$, 把输入的集合取补做就好了.

[code](CF395DIV1C)

D
=

**题意: ** 给一个树$n\le 100000$. 选择一个树根,
使得本质不同的子树个数尽量多.

**做法: ** 首先这是一个树哈希问题. 然后如果确定根,
树哈希可以用map套vector做到正确版本. 然后假如树根移动到旁边一个点上,
其实只有以这两个点为根的子树哈希有变化. 假如我们先以重心为根,
那么根移动的时候(每次移动一条边, 用dfs遍历所有移动的终点),
整棵树的哈希在原来和现在都一定只出现了一次, 所以种类数这里不变;
原来的根现在对应的子树大小肯定大于一半,
并且他现在是大小大于一半且小于全部的子树里严格最大的, 所以没出现过,
种类数加一; 移动的目标点现在成了根, 所以原来的哈希如果只出现了这一次,
种类数也要减一. 这样就知道哪个点为根哈希种类数最多了.

[code](CF395DIV1D)

E. Timofey and our friends animals
==================================

**题意: **

$n \leq 1e5$个人站在了一起，他们之间有$m \leq 1e5 * k$对朋友关系，但是每对朋友之间的距离不超过$k \leq 5$。现在有$q \leq 1e5$个询问，问一段区间的连通块个数。

**题解: **

**方法一: ** 离线LCT。细节不说了。

**方法二: **
或者线段树，维护一个线段两边$k$个的连通性，合并可以做到$k^2$。最后复杂度为$O(n k^2 \log n)$

**方法三: **

首先根据连通块建树，每个连通块对应一棵树，其中每个连通块里面位置最小的那个点为根。然后再从那个点开始dfs建立出来一棵dfs树，每个点记录一下深度（或者给个时间戳）。

那么考虑现在询问一个区间。因为少了一些点，我们建立的那个森林发生了变化（少了一些点，换了一些边）。我们定下规则，新的森林中新产生的边只能是原本深度低的连到高的（我们的森林是dfs序生成的！）。我们要算的是，这个区间对应的新的森林里面，有多少个根（根的集合在我们定下的规则里面是唯一的）。

几个结论

-   原本为根的那些点还是根。

这个比较显然，就不证明了。

-   新成为根的那些点只可能在这个区间两端。准确的说是左右两端恰好$k$个。

想象一下假如有新的根出现在中间。因为原来不是根，那么肯定在原本的树上有个父亲，而且距离不超过k。而这个点距离我们区间两端超过k。矛盾。

然后我们check一下边界上的点就好了。方法就用之前说的新边生成的规则。

最后复杂度为$O(m + qk^2)$，但我觉得这个check可以通过预处理（算出深度小于自己的邻居里面，左右最靠近的）。做到$O(m + qk)$

[code](CF395DIV1E)
