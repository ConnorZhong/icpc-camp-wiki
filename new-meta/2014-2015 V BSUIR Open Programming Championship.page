结果: 最后10题，GYM上排名第3。

H. Spells
=========

**题意:**

现在给你一个字符串，我们用$n \leq 100$个pair，$s_i, t_i, |s_i| \leq 1e4, t_i \leq 1e6$来表示，代表我们的串$s_i$重复$t_i$次，现在你可以选取一系列操作，分别代表为$i_1 \le \le i_2 \le i_3 \le i_m$，代表你按顺序交换$i_j, i_j + 1$。问做这些操作，最后得到的本质不同的字符串有多少个。

**题解:**

考虑什么样的字符串$b$能被我们一开始的串$a$表示出来。

比照$a, b$串的第一个字符，如果相同，我们开始往后比较，否则我们肯定要$swap a$的前两个字母，这样其实就是一个确定的状态机。

这样的问题一般都是可以变成记录在状态机中的位置，然后矩阵乘法做到。这个题目也不例外。

唯一有意思的地方在于由于字符和达到了$1e6$，所以我们不能对每个字符都当做一个矩阵。仔细观察转移矩阵，可以发现一些性质，使得我们对于一个字符串，可以$O(len * C)$的复杂度把矩阵提取出来。

最后复杂度为$O(\sum|S_i| * C + N * C^3)$。
