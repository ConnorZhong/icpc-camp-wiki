B.
==

**题意: ** 定义角度$\pi/2k$($1\le k\le 150$)是一个基本角.
给定平面上两点$A$和$C$. 问有多少$(B,D)$, 满足$B$在$AC$左侧,
$D$在$AC$右侧, $ABCD$四个点组成严格凸四边形,
且$ABCD$中任取3个任意顺序所成的角皆为基本角的倍数.

**做法: ** 我们发现枚举足够多角度后, 剩下的角度已经确定,
可以此时确定那个角度是不是基本角的倍数. 但这样不容易优化.
假设$AC$交$BD$于$O$, 我们尝试枚举角$CAB$, $ACB$, $ABO$和角$CBO$.
其实只用枚举3个. 然后对$D$做和$B$一样的事情(为了对称, $A$ $C$交换).
只要这8个角度满足$O$点的位置吻合, 以及$BO$和$DO$平行,
就能构成一组合法解. 平行的条件就是$CAB$+$ABO$=$ACD$+$CDO$.
这个通过枚举顺序就解决了. 然后是$AO$的长度问题,
我们可以算一个$AO/OC$(用外接圆半径公式按比例计算).
这个比值应该对$D$和$B$相等. 即把可行的$B$对应的比值排序后,
equal\_range一下(注意$D$和$B$是左右反着的, 比值相等要取倒数,
为了精度问题取$log$).

[code](gym101237B)

G. Total LCS
============

**题意：**

给你两个长度分别为$n$和$m$的字符串$s$和$t$（$1\leq n,m\leq 2000$）。求$s$和所有$t$的子区间（一共$\frac{m(m+1)}{2}$个）的LCS。

**做法：**

固定左端点$L$，右端点$R$往右的过程中答案不减，有时会加1。加1可以理解为：$t[R]$一定会出现在LCS的所有方案中。

可以发现对于一个固定的右端点$j$，可以使$t[j]$一定出现在LCS中的左端点，是一段形如$(x,j]$的区间。算出这个就可以用上面的办法算答案了。

考虑用dp。$H[i][j]$表示$s$中使用$1..i$的子串进行LCS，$t$中右端点固定为$j$的情况下，当$L\in (H[i][j],j]$时，$t[j]$一定出现在$LCS(s[1..i],t[L..j])$中。

为了算这个还要用到$V[i][j]$表示$s$中使用$1..i$的子串进行LCS，$t$中右端点固定为$j$的情况下，当$L\in [1..V[i][j]]$时，$s[i]$一定出现在LCS(s\[1..i\],t\[L..j\])中。

边界条件：$H[0][j]=j$，$V[i][0]=0$

转移1：当$s[i]==t[j]$，计算$H[i][j]$。$t[j]$一定出现在LCS中：考虑$i$和左端点固定，右端点从$j-1$移动到了$j$，LCS增加了1，也就是存在一种不使用$s[i]$的$LCS(s[1..i],t[1..j-1])$方案，然后加上$s[i]$和$t[j]$这对。

如果不出现这样的情况，当且仅当$LCS(s[1..i],t[1..j-1])$的所有方案都用到了$s[i]$也就是$V[i][j-1]$，所以得到$H[i][j]=V[i][j-1]$。

当$s[i]==t[j]，$计算$V[i][j]$。考虑左端点和$j$固定，从$i-1$移动到$i$，大概可以同理得到$V[i][j]=H[i-1][j]$。

转移2：当$s[i] \neq t[j]$，计算$H[i][j]$。为了要$t[j]$一定进入LCS，此时$LCS(s[1..i],t[1..j])$的方案也是$LCS(s[1..i-1],t[1..j])$的方案，所以$H[i][j]\geq H[i-1][j]$。但从$s[1..i-1]$移动到$s[1..i]$，添加的$s[i]$可能会影响LCS的大小，所以$s[i]$不能一定出现在$LCS(s[1..i],t[1..j-1])$中，因此还要有$H[i][j]\geq V[i][j-1]$。得到$H[i][j]=max(H[i-1][j],V[i][j-1])$。

当$s[i] \neq t[j]$，计算$V[i][j]$。类似上面，$s[i]$一定要和前面配对，$t[j]$不能一定要和前面配对，所以有$V[i][j]=min(H[i-1][j],V[i][j-1])$。

复杂度$O(n^2)$。感觉我并不能讲清楚，还是看代码比较好一点吧。

[code](gym101237G)

H. Cyclic String
================

**题意: **

给你一个环状的字符串，长度$n \leq 2000$，要求你划分成恰好 $k \leq 2000$
个子串，要求他们的字典序最大的子串，字典序尽量小。

**题解: **

首先把这个环状字符串写成最小表示的形式。那么答案至少不可能比当前的字符串小。

考虑最后的答案，有两种可能。

-   如果答案比当前最小表示的串要大，且在他们的LCP位置后一个字符，答案严格比当前最小表示的对应位置要大。

这种情况下有一个性质，如果对于原来的环状字符串存在一种合法的划分方案。即一定存在一种划分方案是在当前的最小表示法串上（注意这里不是环状了）。

证明可以考虑把原来跨过起始位置的区间从起始位置那里断开，这样我们得到了一个$k + 1$的方案，然后我们把第一段和第二段接在一起，根据答案的性质这样还是可行的。

那么对于这个串，我们要检查答案是多少。

使用经典办法，我们枚举答案($O(n)$复杂度)，然后我们从后面开始切这个字符串，按照能切就切的原则，希望尽可能切成最多的段。

可以发现这个贪心是很显然的。然后我们检查切的段数是否大于等于$k$，是的话，我们把多的部分和第一段合并即可。

这一部分复杂度为$O(n^2*C)$

-   如果答案是最小表示法的一个前缀

这样一来，我们没有了之前的所有性质，注意这样的话，我们就不一定能把环破坏了。

但是有一个好消息是我们可以二分答案了。

考虑二分了一个前缀，如何判断合法呢？

先枚举一个断开的位置。因为我们的答案是最小表示法的前缀，所以我们最后划分出来的$K$段必然都是答案的一个前缀。

考虑设$f[i]$为到第$i$个位置来，能够划分成多少份。可以证明，这个可以划分的份数是一个连续区间，所以我们算出最多和最少即可。

为了使复杂度靠谱，我们需要使用KMP，算出KMP后最长和最短的长度。

如果最后可以弄出来$K$份，我们就成功了。

这一部分复杂度为$O(n^2logn)$

然后就。。成功了!!写了200行。。

[code](gym101237H)

I.
==

**题意: ** 给你平面上$n$($n\le 2000$)个点和一个圆.
保证所有的点都和圆相离. 问最多能选出多少个点,
他们两两所在的直线都和圆相离. 已知没有两点有关于圆的公共切线.

**做法: ** 每个点到圆做两条切线, 两个切点所连的劣弧称为这个点的投影弧.
能够证明两个点所在的直线和圆相离, 当且仅当他们的投影弧有交且不包含.
所以本题可以转化为, 给定圆上若干弧, 选出尽量多的弧,
使得两两有交且不包含. 这个"两两有交和不包含"关系有一个性质,
设$f(a, b)$为一函数, 当弧$a$和弧$b$有交且不包含时, $f(a,b)$为$1$,
否则为$0$. 假设$\overline{a}$是$a$的补弧,
那么$f(\overline{a},b)=f(a,b)$对任意$b$成立.
所以我们可以把经过某一定点的弧取补, 这样问题就从环上转化到了数轴上.
在数轴上, 一些线段两两有交且不包含,
当且仅当他们按照左端点排序和按照右端点排序的顺序一样,
并且这个顺序中第一个和每一个线段有交. 于是我们把所有线段按照左端点排序,
枚举第一个区间,
取出后面(即左端点大于第一个区间的左端点)且所有右端点大于第一个区间右端点(即不包含)且左端点小于第一个区间右端点(即和第一个线段相交)的线段,
把他们按顺序, 以右端点为关键字求一个最长上升子序列即可更新答案.

[code](gym101237I)

K. Tree Problem
===============

**题意: **

给你一棵树$n \leq 2e5$个点，一开始每条边权值为1。现在有$q \leq 2e5$个操作。

-   问一条路径的权值和。

-   把一条路径上每条边都清0，所有有一个端点在这条路径上的边权值改为1。

**题解: **

首先转换题意。点和边上都有一个时间戳。每次修改操作，我们就把这条路径上的点和边打上现在的时间戳。

那么具有**两侧点的时间戳严格大于边的时间戳**的边权值为1。

考虑如果是在链上，这个问题是简单的，就是把一串路径改为0，两侧的边改为1。

那么我们使用轻重链剖分，对于轻边暴力即可。为了轻边能够暴力，我们要维护点的标号。轻边的标号暴力记一下就好。

[code](gym101237K)
