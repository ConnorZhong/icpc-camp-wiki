Topcoder
========

RabbitWorking\[SRM Round 542 Hard\]
-----------------------------------

题意：给定$N \le 50$个点的无向图，边权非负。现在要选择$K$个点的子图，使得$\frac{\text{边权之和}}{K*(200-K)}$最大。

题解：很容易想到分数规划，问题在于二分的$\lambda$不容易摊到每个点权上。要点在与因为边权非负，故所有边都必选。故可以将$K^2$项摊到每条边上去。即建出了流模型。

注意分数规划的正确性建立在选择的分母集合不为空，当猜测的$\lambda$太过分时流只能求出来空子图，二分时要注意限定$>\lambda$而不是$\ge \lambda$。

OldBridges\[SRM Round 556 Hard\]
--------------------------------

题意：给定一个$N \le 50$个点的无向图，每条边的容量为$0,2$或$\infty$。判断一个双物品的网络流是否可行，第一个从$S_1$到$T_1$流量为$2C_1$，第一个从$S_2$到$T_2$流量为$2C_2$。

题解：第一遍连$(S,S_1,2*C_1),(S,S_2,2*C_2),(T_1,T,2*C_1),(T_2,T,2*C_2)$，显然最大流为$2*(C_1+C_2)$为必要条件。

第二遍连$(S,S_1,2*C_1),(S,T_2,2*C_2),(T_1,T,2*C_1),(S_2,T,2*C_2)$，显然最大流为$2*(C_1+C_2)$也为必要条件。

现在证明这两个条件都满足则充分：

因为容量都为偶数，故一定存在流量都为偶数的流。设第一遍的流为$f_1$，第二遍为$f_2$。

设$g_1=(f_1+f_2)/2$，$g_2=(f_1-f_2)/2$，可知$g_1$是一个从$S_1$到$T_1$流量为$2C_1$的合法流，$g_2$是一个从$S_2$到$T_2$流量为$2C_2$的合法流。

现在将$g_1,g_2$看作两种不同的物品并到一个图上，自然想到这样直接并可能导致容量限制不成立，现证明容量限制依然成立：

对于一条边$e$，$|g_1(e)|+|g_2(e)|=|(f_1(e)+f_2(e))|/2+|(f_1(e)-f_2(e))|/2=max\{|f_1(e)|,|f_2(e)|\}$。

SurroundingGame\[SRM Round 558 Hard\]
-------------------------------------

题意：给定一个$20 \times 20$的棋盘每个格子被选择的代价和被包住的收益。“被包住”定义为该格子被选或相邻的格子都被选。要选择一些格子使得总收益减总代价最大。

题解：学习了[PTY的论文](/浅析一类最小割问题(pty).pdf)之后可以爆搞之。核心思想在于对每个格子建两个点$u,u'$，$u$表示这个格子选或不选，$u'$表示邻域是否必须全选。则可以转化为二元关系。

为了保持容量非负需要对一些点的割意义进行反转。

FoxAndCake\[TCO12 Round 3A Medium\]
-----------------------------------

题意：给定一个$10^9 \times 10^9$的棋盘以及上面的$1$个黑点，$3$个红点，$3$个蓝点，要求把棋盘分成四块联通的部分（可以有洞）。要求第一块恰好包含黑点，剩下的三块恰好包含一个红点和一个蓝点。问是否可行。

题解：显然黑点的那块可以就要黑点一块，剩下的直接离散化然后流判定即可，离散化的时候对于过大的gap缩小到5即可。

IndependentOfOR\[TCO12 Semifinal 2 Medium\]
-------------------------------------------

题意：定义一个自然数集合$T$为“好”的，当且仅当它的子集或值有$2^{|T|}$种不同的结果。给定一个大小为$50$的集合$S$，元素范围不超过$10^6$，求一个$S$的“好”的子集$T$，使得$T$的元素之和最大。

题解：稍加分析可知一个集合$T$为“好”的，当且仅当对于集合中的每个元素$e \in T,\text{OR}(T) \neq \text{OR}(T-\{e\})$。也就是说每个元素都有一个“专有位”，枚举“专有位”的集合，剩下的部分很容易做到$O(|S|+20)$。

ElevenMultiples\[TCO12 Round 3B Medium\]
----------------------------------------

题意：给定$N \le 50$个数字组成的串，每个串长不超$50$，问有多少种排列使得首尾接起来以后的数字可以被$11$整除，答案模1000000007。

题解：被$11$整除的充要条件为奇位之和减偶位之和被$11$整除。考虑$k$个长度为奇的串，必定有$\lfloor k/2\rfloor$个串首位在奇位上，其余的在偶位上，所以做个背包就行了。对于长度为偶的串，首位在奇位还是在偶位可以随便选（只要至少有一个长度为奇的串），所以还是个背包。

注意判掉没有串长度为奇的情况。复杂度$O(11*N^2)$

ChromaticNumber\[TCO12 Round 3A Easy\]
--------------------------------------

题意：给定$N$个点的图，每个点的度数$\ge N-3$，求最小染色数。

题解：补图显然每个点的度数不超过$2$，则直接统计补图的最小团覆盖即可，注意三元环的情况。

Nisoku\[SRM Round 463 Medium\]
------------------------------

题意：给定$N\le 50$个$[1.5,10.0]$的实数，每次可以选择两个数，选择将其合并为它们的和或积，问最后剩下的数的最大值。

题解：通过推一下式子可知，每个数最多会被加一次，所以就是要匹配。继续观察可以发现，如果确定了要被加的数的集合，一定是最大和最小两两匹配。

故先排序，然后直接DP，$f_{i,j}$表示$i$之前和$j$之后的数都确定了的最大值，转移考虑第$i$个数和第$j$个数要不要匹配。

FlattenOut\[TCO12 Round 2C Hard\]
---------------------------------

题意：给定一个长度为$N\le 50$的环，每个元素$-10^{16}\le a_i\le 10^{16}$为整数。现在要模拟$T\le 10^{16}$轮，每轮对于一个$a_i > 0$，都会有$a_i$减$1$,$a_{(i+1) \mod N}$加$1$。求$T$轮之后的结果。

题解：直接模拟关键时刻（负数或$0$被填成正数，正数被耗成$0$）。可知每模拟$N$次至少有一个负数被填掉（要么一个正数不剩结束），于是模拟$N^2$次之后一定没有负数。又模拟$N$轮之后要么全部都为正数结束，要么只剩$0,1$，只剩$0,1$之后每轮都变成了shift，容易求解。

BinaryPolynomialDivOne\[SRM Round 536 Hard\]
--------------------------------------------

题意：给定一个$Z_2$下的$0 \le n \le 49$次多项式$P$和一个整数$1 \le m \le 10^{16}$，求多项式$P^m$的第$k$项系数。

题解：$Z_2$下的多项式有一个非常好的性质：$P^2(x)=P(x^2)$。利用这个性质，首先可以对$P^m(x)$进行二进制分解，第$i$个多项式为$P(x^{2^{m_i}})$。

余下的事则是要在$\log m$个多项式中求凑出$k$的方案数。从高到低的确定到第$i$个多项式时，则可知余下的多项式最多凑出$x^{n*2^{m_i+1}}$，即上一轮凑出的数有机会凑出$k$的只有$O(n)$级别（考虑从高到低的数位DP），故状态总数为$O(n*\log m)$，转移复杂度为$O(n)$，总复杂度为$O(n^2*\log m)$。

PQHulls\[TCO12 Round 3B Hard\]
------------------------------

题意：给定平面上的$3\le N\le 2000$个整点和另外两个整点$P,Q$，保证无三点共线，坐标范围不超$10^8$。

求有多少个$N$个点的子集$T$满足，$|T|\ge 3$，并且$T$的凸包可以同时包住$P,Q$两点，答案模1000000007。

题解：采用卷的方式枚举凸包肯定是不够快的，只能容斥。

考虑计算一个简单问题：统计多少个子集满足凸包不包住点$P$，为了不重复计数，我们枚举$P$关于凸包的（有向）切点$V$，则选择任意$\vec{PV}$右手方向的点的子集都满足要求。

还需要统计：统计多少个子集满足凸包不包住点$P,Q$，做法和前面的类似，先枚举$P$关于凸包的（有向）切点$V$，把$\vec{PV}$左手方向的点都删掉。然后在剩下的点里按极角有序枚举$Q$关于凸包的（有向）切点$U$，统计剩下的点里有多少个点在$\vec{QU}$右手方向即可。通过预排序容易做到$O(N^2)$。

CowsMooing\[TCO12 Round 3A Hard\]
---------------------------------

题意：给定$N\le 30$个01串$s_i$，第$i$个串的长度为$Len_i\le 50$。
定义$$f(t)=\sum_{i=0}^{N-1}s_i[t \mod Len_i]$$
$$cnt_x=(\sum_{t=0}^{50!-1}[f(t)=x]) \mod 10007$$

求$cnt[0\dots N]$。

题解：首先，将长度相同的串直接并起来。

如果$Len_i$两两互质，这个问题是简单的：对于两个串已知他们的分布，则他们并的分布为两个串各自分布的卷积（因为互质，每个下标的pair在并之后恰好出现一次），暴力卷积的复杂度为$O(N^3)$。

对于不互质的情况，我们试图确定一个$R$，将$t \mod R$相同的一起统计。可以发现对于确定的$r=t \mod R$，每个串被分解为一个长度为$\frac{Len_i}{(Len_i,R)}$的串。

那么如果我们确定$R=2^5*3^3*5^2*7^2$，则每个串被分解后的长度要么为$1$，要么为一个质数，满足两两互质。

但此时的计算量为$2^5*3^3*5^2*7^2*O(N^3)$，已经很接近，但难以承受。

如果取$R=2^4*3^2*5$，则每个串被分解后的长度要么为$1$，要么为一个质数，要么为$7$或$49$。$7$和$49$是唯一不互质的对。

所以暴力把每个长度为$7$的串复制延长到$49$，则又满足两两互质。

最后的计算量为$2^4*3^2*5*O(N^3)$。

MatrixPower\[TCO11 Semifinal 1 Hard\]
-------------------------------------

题意：给定$1\le n\le 10000,0\le d\le 10^9,1\le q,k\le 10^9$，定义一个$n \times n$矩阵$A_{i,j}=d*i+q^j$。

给定不超过$50$个询问，询问$A^k$的某个entry的值，答案模$1000000007$。

题解：

ConsecutiveFloors\[TCO15 Semifinal Easy\]
-----------------------------------------

题意：对于一个长度为$m$的序列$a_1,a_2,\dots,a_m$，有$f(x)=\sum_{i=1}^{m}\max(0,a_i-x+1)$。

给定不超过$50$组$x_i\le 10^9$和$f(x_i)\le 10^9$，判定是否存在一个序列满足要求。

题解：

FoxAirline\[TCO15 Semifinal Medium\]
------------------------------------

题意：对于一个给定的$n\le 12$个点的有向带权图，取一个权值和最小的包含$n$个点的强连通子图。

题解：

DoubleOrOne\[TCO15 Semifinal Hard\]
-----------------------------------

题意：给定两个整数$0\le a,b\le 100$，每次可以选择将$a=a*2,b=b+1$或者$a=a+1,b=b*2$。要求给出操作不超过$2500$次使得两数相等。

保证有解，输出方案。

题解：

Jumps\[TCO15 Final Easy\]
-------------------------

题意：给定一个长度不超过$50$的序列$a$，$1\le a_i\le 10^{18}$。

判定是否可以用过将$a$添加元素和重排的方式得到序列$b$（不需要满足$a$的范围限制），使得$2^{i-1}=b_{i+1}-b_i$。

题解：

FrogsOnGrid\[TCO15 Final Medium\]
---------------------------------

题意：给定一个$H \times W$的网格（$H,W\le 1e^6$），其中挖掉不超过$50$个点。判定是否可以将没有被挖掉的点划分为若干个序列，对于每个序列$(r_0,c_0),(r_1,c_1),\dots,(r_{n-1},c_{n-1})$，满足$r_{(i+1) \mod n}=r_i \wedge c_{(i+1) \mod n}=(c_i+1) \mod \vee W r_{(i+1) \mod n}=(r_i+1)\mod H \wedge c_{(i+1) \mod n}=c_i$

题解：
